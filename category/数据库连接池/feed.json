{
    "version": "https://jsonfeed.org/version/1",
    "title": "繁華落盡 似水流年 • All posts by \"数据库连接池\" category",
    "description": "编程日记 & 随笔",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/value/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0",
            "url": "http://example.com/value/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0",
            "title": "数据库连接池(C++)",
            "date_published": "2024-03-29T08:47:41.221Z",
            "content_html": "<h1 id=\"数据库连接池\"><a class=\"anchor\" href=\"#数据库连接池\">#</a> 数据库连接池</h1>\n<h2 id=\"数据库连接池概述\"><a class=\"anchor\" href=\"#数据库连接池概述\">#</a> 数据库连接池概述</h2>\n<blockquote>\n<p>提高数据库的访问瓶颈（关系型数据库）：</p>\n<ol>\n<li>缓存服务器 <code>Redis</code></li>\n<li>数据库连接池</li>\n</ol>\n</blockquote>\n<p>一般而言，对于数据库操作都是在访问的时候创建连接，访问完毕之后断开连接。在高并发的情况下，频繁的连接创建和释放会有很大的开销。需要进行如下过程：</p>\n<ol>\n<li>建立通信的连接 TCP 三次握手</li>\n<li>数据库服务器的连接认证</li>\n<li>关闭数据库连接时资源是释放</li>\n<li>断开通信连接 TCP 四次挥手</li>\n</ol>\n<h2 id=\"mysql-api\"><a class=\"anchor\" href=\"#mysql-api\">#</a> MySQL  API</h2>\n<h3 id=\"mysql_init\"><a class=\"anchor\" href=\"#mysql_init\">#</a>  <code>mysql_init</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>MYSQL <span class=\"token operator\">*</span><span class=\"token function\">mysql_init</span><span class=\"token punctuation\">(</span>MYSQL <span class=\"token operator\">*</span>mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mysql_real_connect\"><a class=\"anchor\" href=\"#mysql_real_connect\">#</a>  <code>mysql_real_connect</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>MYSQL <span class=\"token operator\">*</span><span class=\"token function\">mysql_real_connect</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tMYSQL <span class=\"token operator\">*</span>mysql<span class=\"token punctuation\">,</span>\t\t\t\t<span class=\"token comment\">//mysql_init () 函数的返回值</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>host<span class=\"token punctuation\">,</span>\t\t\t <span class=\"token comment\">//mysql 服务器的 IP 地址</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>user<span class=\"token punctuation\">,</span> \t\t\t <span class=\"token comment\">//mysql 服务器的用户名</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>password<span class=\"token punctuation\">,</span> \t      <span class=\"token comment\">//mysql 服务器用户对应的密码</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>db<span class=\"token punctuation\">,</span>\t\t\t\t <span class=\"token comment\">// 数据库名</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">,</span>\t\t\t <span class=\"token comment\">//mysql 服务器的监听端口</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>unix_socket<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> client_flag\t</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>返回值：</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t成功：返回有效的 MYSQL 连接句柄</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t失败：NULL</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t句柄：一个实例 / 对象</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>*/</span></pre></td></tr></table></figure><h3 id=\"mysql_query\"><a class=\"anchor\" href=\"#mysql_query\">#</a>  <code>mysql_query</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">mysql_query</span><span class=\"token punctuation\">(</span>MYSQL <span class=\"token operator\">*</span>mysql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>返回值：</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t成功：返回 0，同时查询结果（结构集）存储在 mysql 句柄中</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t失败：返回非 0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>*/</span></pre></td></tr></table></figure><h3 id=\"mysql-store_result\"><a class=\"anchor\" href=\"#mysql-store_result\">#</a>  <code>mysql store_result</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>MYSQL_RES <span class=\"token operator\">*</span><span class=\"token function\">mysql_store_result</span><span class=\"token punctuation\">(</span>MYSQL <span class=\"token operator\">*</span>mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>返回值：</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t成功：返回结果集</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t失败：返回 NULL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>*/</span></pre></td></tr></table></figure><h3 id=\"mysql_num_fields\"><a class=\"anchor\" href=\"#mysql_num_fields\">#</a>  <code>mysql_num_fields</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//  获取结果集中的列数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> <span class=\"token function\">mysql_num_fields</span><span class=\"token punctuation\">(</span>MYSQL_RES <span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mysql_fetch_fields\"><a class=\"anchor\" href=\"#mysql_fetch_fields\">#</a>  <code>mysql_fetch_fields</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//  获取结果集的列名</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>MYSQL_FIELD <span class=\"token operator\">*</span><span class=\"token function\">mysql_fetch_fields</span><span class=\"token punctuation\">(</span>MYSQL_RES <span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>MYSQL_FIELD</code>  对应的结构体定义在 <code>mysql.h</code>  文件中，定义如下：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// mysql.h</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">st_mysql_field</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>name<span class=\"token punctuation\">;</span>\t\t\t\t</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span>MYSQL_FIELD<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mysql_fetch_lengths\"><a class=\"anchor\" href=\"#mysql_fetch_lengths\">#</a>  <code>mysql_fetch_lengths</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 返回结果集内</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> <span class=\"token operator\">*</span><span class=\"token function\">mysql_fetch_lengths</span><span class=\"token punctuation\">(</span>MYSQL_RES <span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mysql_fetch_row\"><a class=\"anchor\" href=\"#mysql_fetch_row\">#</a>  <code>mysql_fetch_row</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>MYSQL_ROW<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 取出结果集中的下一行记录（每调用一次，当前的记录会被弹出）</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>MYSQL_ROW <span class=\"token function\">mysql_fetch_row</span><span class=\"token punctuation\">(</span>MYSQL_RES <span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>返回值：</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t成功：得到</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t失败：返回 NULL</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>*/</span></pre></td></tr></table></figure><h3 id=\"遍历结果集\"><a class=\"anchor\" href=\"#遍历结果集\">#</a> 遍历结果集</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>MYSQL_FIELD <span class=\"token operator\">*</span>fields <span class=\"token operator\">=</span> <span class=\"token function\">mysql_fetch_fields</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">int</span> length <span class=\"token operator\">=</span> <span class=\"token function\">mysql_num_fields</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mysql_free_result\"><a class=\"anchor\" href=\"#mysql_free_result\">#</a>  <code>mysql_free_result</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 释放结果集对应的内存空间</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">mysql_free_result</span><span class=\"token punctuation\">(</span>MYSQL_RES <span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mysql_close\"><a class=\"anchor\" href=\"#mysql_close\">#</a>  <code>mysql_close</code></h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 关闭数据库连接实例，释放 mysql_init () 申请得到的空间</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">mysql_close</span><span class=\"token punctuation\">(</span>MYSQL<span class=\"token operator\">*</span> mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"字符编码设置\"><a class=\"anchor\" href=\"#字符编码设置\">#</a> 字符编码设置</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 获取当前连接默认的字符集</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">mysql_character_set_name</span><span class=\"token punctuation\">(</span>MYSQL<span class=\"token operator\">*</span> mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 设置编码集</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">mysql_set_charater_set</span><span class=\"token punctuation\">(</span>MYSQL<span class=\"token operator\">*</span> mysql<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>character_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"事务操作\"><a class=\"anchor\" href=\"#事务操作\">#</a> 事务操作</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 设置数据库的提交方式（自动提交 mode:true、手动提交 mode:false）</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>my_bool <span class=\"token function\">mysql_autocommit</span><span class=\"token punctuation\">(</span>MYSQL<span class=\"token operator\">*</span> mysql<span class=\"token punctuation\">,</span> my_bool mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>返回值：</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t成功：true</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t失败：false</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>*/</span></pre></td></tr></table></figure><figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 提交事务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>my_bool <span class=\"token function\">mysql_commit</span><span class=\"token punctuation\">(</span>MYSQL <span class=\"token operator\">*</span>mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>返回值：</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t成功：true</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t失败：false</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>*/</span></pre></td></tr></table></figure><figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 事务回滚</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>my_bool <span class=\"token function\">mysql_rollback</span><span class=\"token punctuation\">(</span>MYSQL <span class=\"token operator\">*</span>mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>返回值：</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t成功：true</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t失败：false</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>*/</span></pre></td></tr></table></figure><h3 id=\"获取错误信息\"><a class=\"anchor\" href=\"#获取错误信息\">#</a> 获取错误信息</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">mysql_error</span><span class=\"token punctuation\">(</span>MYSQL<span class=\"token operator\">*</span> mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> <span class=\"token function\">mysql_errno</span><span class=\"token punctuation\">(</span>MYSQL<span class=\"token operator\">*</span> mysql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"数据库连接池实现\"><a class=\"anchor\" href=\"#数据库连接池实现\">#</a> 数据库连接池实现</h2>\n<ul>\n<li>数据库连接类</li>\n<li></li>\n</ul>\n",
            "tags": [
                "C++",
                "数据库",
                "池化技术"
            ]
        }
    ]
}