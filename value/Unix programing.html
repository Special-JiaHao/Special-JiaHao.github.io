<!-- build time:Tue Apr 30 2024 16:01:27 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="繁華落盡 似水流年" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="繁華落盡 似水流年" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="繁華落盡 似水流年" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="C++"><link rel="canonical" href="http://example.com/value/Unix%20programing.html"><title>UNIX网络编程 - Unix | Value's Blog = 繁華落盡 似水流年 = 寄予厚望 还请善待</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">UNIX网络编程</h1><div class="meta"><span class="item" title="Created: 2023-07-20 17:00:34"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2023-07-20T17:00:34+08:00">2023-07-20</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>9.6k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>9 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Value's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://raw.githubusercontent.com/Special-JiaHao/images/main/UNIX-logo.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Unix/" itemprop="item" rel="index" title="In Unix"><span itemprop="name">Unix</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://example.com/value/Unix%20programing"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Value"><meta itemprop="description" content="寄予厚望 还请善待, 编程日记 & 随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="繁華落盡 似水流年"></span><div class="body md" itemprop="articleBody"><h2 id="传输层tcp-udp和sctp"><a class="anchor" href="#传输层tcp-udp和sctp">#</a> 传输层：TCP、UDP 和 SCTP</h2><h2 id="套接字编程"><a class="anchor" href="#套接字编程">#</a> 套接字编程</h2><h3 id="套接字地址结构"><a class="anchor" href="#套接字地址结构">#</a> 套接字地址结构</h3><h4 id="ipv4套接字地址结构"><a class="anchor" href="#ipv4套接字地址结构">#</a> IPV4 套接字地址结构</h4><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*    IPV4 套接字地址     */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> sa_family_t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    sa_family_t sa_famliy<span class="token punctuation">;</span>   <span class="token comment">/* 套接字地址结构的地址族 */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">char</span> sa_data<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">/* 端口号（2 字节）+ IP 地址（4 字节） + 填充（8 字节） */</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="8"></td><td><pre>Synopsis：</pre></td></tr><tr><td data-num="9"></td><td><pre>    #include &lt;sys/socket.h></pre></td></tr><tr><td data-num="10"></td><td><pre>Additional:</pre></td></tr><tr><td data-num="11"></td><td><pre>	sockaddr 是通用的套接字地址结构，是早期的版本，同时与各种套接字函数都是适配的；当套接字作为一个参数参入套接字函数时，往往是以引用形式（也就是以指向该地址的指针）来传递。</pre></td></tr><tr><td data-num="12"></td><td><pre>	当使用便于赋值和使用的新型地址结构 sockaddr_in 时，使用套接字函数，传入套接字地址时，需要做一个强制类型转换变成通用的套接字地址结构的指针。</pre></td></tr><tr><td data-num="13"></td><td><pre>	struct sockaddr_in serv;</pre></td></tr><tr><td data-num="14"></td><td><pre>	(struct socketaddr *)&amp; serv;</pre></td></tr><tr><td data-num="15"></td><td><pre>*/</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">uint16_t</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token keyword">uint32_t</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">uint16_t</span> in_port_t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">uint32_t</span> in_addr_t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">in_addr</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    in_addr_t	s_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">/* POSIX 规范只需要 3 个字段：sin_family, sin_port, sin_addr */</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">uint8_t</span> sin_len<span class="token punctuation">;</span>	       <span class="token comment">/* 长度字段，部分厂家支持，简化了长度可变套接字地址结构的处理 */</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    sa_family_t sin_family<span class="token punctuation">;</span>    <span class="token comment">/* 套接字地址结构的地址族 */</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">in_addr</span> sin_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    in_port_t sin_port<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">char</span> sin_zero<span class="token punctuation">[</span><span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span>sa_family<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span>in_port_t<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">in_addr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="32"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="33"></td><td><pre>	#include &lt;netinet/in.h></pre></td></tr><tr><td data-num="34"></td><td><pre>Additional:</pre></td></tr><tr><td data-num="35"></td><td><pre>	sin_addr 定义为一个结构体而不仅仅是一个 in_addr_t 类型的无符号长整数，这是有历史原因的；早期的版本把 in_addr 结构定义为多种结构的联合，允许访问一个 IPV4 地址中的所有字节，或者访问它的 2 个 16 位值。这是为了适应地址被划分为 A、B 和 C 三类的时期，便于获取地址中适当的字节。然而随着子网划分技术的来临和无类地址编排的出现，各种地址类正在消失，这种联合也就不再需要了。</pre></td></tr><tr><td data-num="36"></td><td><pre>*/</pre></td></tr></table></figure><h4 id="ipv6套接字地址结构"><a class="anchor" href="#ipv6套接字地址结构">#</a> IPV6 套接字地址结构</h4><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* IPV6 套接字地址结构 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">in6_addr</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="值-结果参数"><a class="anchor" href="#值-结果参数">#</a> 值 - 结果参数</h3><p>当往套接字函数传递一个套接字地址结构时，该结构总是以引用的形式来传递，也就是传递指向该结构的一个指针；其有两种传递方式</p><ul><li>从进程到内核传递套接字地址的函数有：connect、bind 和 sendto。这些函数的一个参数是指向某个套接字地址结构的指针，另外一个参数是指向该结构的整形大小；（即指针和指针所指内容的大小都传递给了内核，于是内核找到到底需要从进程复制多少数据进来）</li><li>从内核到进程传递套接字地址的函数有：accept、recvfrom、getsockname 和 getpeername。这些函数的</li></ul><h3 id="字节排序函数"><a class="anchor" href="#字节排序函数">#</a> 字节排序函数</h3><p>内存中储存数据的方式有两种：大端字节序和小端字节序；两种格式都有系统使用，目前并没有统一的标准，对于给定的系统，其使用的字节序称为主机字节序。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">uint16_t</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token keyword">uint16_t</span> host_port<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">uint16_t</span> <span class="token function">ntohs</span><span class="token punctuation">(</span><span class="token keyword">uint16_t</span> net_port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">uint32_t</span> <span class="token function">htonl</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> host_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">uint32_t</span> <span class="token function">ntohl</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> net_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	使用这些函数时，并不需要关系主机字节序和网络字节序的真实值；</pre></td></tr><tr><td data-num="8"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="字符操纵函数"><a class="anchor" href="#字符操纵函数">#</a> 字符操纵函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;strings.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">bcopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">bcmp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">memsset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">memcmp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="地址转换函数"><a class="anchor" href="#地址转换函数">#</a> 地址转换函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* IPV4 地址转换函数 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">inet_aton</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>strptr<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">in_addr</span> <span class="token operator">*</span>addrptr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Description:</pre></td></tr><tr><td data-num="6"></td><td><pre>	将 strptr 所指 C 字符串转化为一个 32 位的网络字节序二进制值，并通过指针 addrptr 来存储。</pre></td></tr><tr><td data-num="7"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="8"></td><td><pre>	若成功则返回 1，否则返回 0；</pre></td></tr><tr><td data-num="9"></td><td><pre>*/</pre></td></tr><tr><td data-num="10"></td><td><pre>in_addr_t <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>strptr<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* 已被废弃 */</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="12"></td><td><pre>Description:</pre></td></tr><tr><td data-num="13"></td><td><pre>	将 strpre 所指 C 字符串转化为一个 32 位的网络字节序二进制值，并将结果作为函数的返回值。不能用于处理 255.255.255.255 这种广播地址，该地址的二进制值被用来指示函数失败。</pre></td></tr><tr><td data-num="14"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="15"></td><td><pre>	出错时该函数返回 INADDR_NONE 常值（32 位均为 1 的值），成功则返回正确的地址序列。</pre></td></tr><tr><td data-num="16"></td><td><pre>*/</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">inet_ntoa</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">in_addr</span> inaddr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="19"></td><td><pre>Description:</pre></td></tr><tr><td data-num="20"></td><td><pre>	将一个 32 位的网络字节序二进制 IPV4 地址转换为相应的点分十进制数串</pre></td></tr><tr><td data-num="21"></td><td><pre>*/</pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* IPV4、IPV6 地址转换函数 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">inet_pton</span><span class="token punctuation">(</span><span class="token keyword">int</span> family<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>strptr<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>addrptr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="5"></td><td><pre>	#include &lt;arpa/inet.h></pre></td></tr><tr><td data-num="6"></td><td><pre>Description:</pre></td></tr><tr><td data-num="7"></td><td><pre>	faimly: 地址族 (AF_INET、AF_INET6)</pre></td></tr><tr><td data-num="8"></td><td><pre>	strptr: 需要转换的字符串指针</pre></td></tr><tr><td data-num="9"></td><td><pre>	addrptr: 指向转换后的二进制结果</pre></td></tr><tr><td data-num="10"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="11"></td><td><pre>	若成功则返回 1，失败则返回 - 1；</pre></td></tr><tr><td data-num="12"></td><td><pre>*/</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">inet_ntop</span><span class="token punctuation">(</span><span class="token keyword">int</span> family<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>addrptr<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>strptr<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="15"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="16"></td><td><pre>	#include &lt;arpa/inet.h></pre></td></tr><tr><td data-num="17"></td><td><pre>Description:</pre></td></tr><tr><td data-num="18"></td><td><pre>	family:</pre></td></tr><tr><td data-num="19"></td><td><pre>	addrptr:</pre></td></tr><tr><td data-num="20"></td><td><pre>	strptr:</pre></td></tr><tr><td data-num="21"></td><td><pre>	len:</pre></td></tr><tr><td data-num="22"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="23"></td><td><pre>	若成功则返回指向结果的指针，若出错则为 NULL</pre></td></tr><tr><td data-num="24"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="readn-writen和readline函数"><a class="anchor" href="#readn-writen和readline函数">#</a> readn、writen 和 readline 函数</h3><h2 id="tcp套接字编程"><a class="anchor" href="#tcp套接字编程">#</a> TCP 套接字编程</h2><h3 id="socket函数"><a class="anchor" href="#socket函数">#</a> socket 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="4"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="5"></td><td><pre>Description:</pre></td></tr><tr><td data-num="6"></td><td><pre>	domain: 协议域</pre></td></tr><tr><td data-num="7"></td><td><pre>		- AF_INET:IPV4 protocal</pre></td></tr><tr><td data-num="8"></td><td><pre>		- AF_INET6:IPV6 protocal</pre></td></tr><tr><td data-num="9"></td><td><pre>		- AF_LOCAL:Unix 域协议</pre></td></tr><tr><td data-num="10"></td><td><pre>		- AF_ROUTE: 路由套接字</pre></td></tr><tr><td data-num="11"></td><td><pre>		- AF_KEY: 秘钥套接字</pre></td></tr><tr><td data-num="12"></td><td><pre>	type: 套接字类型</pre></td></tr><tr><td data-num="13"></td><td><pre>		- SOCK_STREAM: 字节流套接字</pre></td></tr><tr><td data-num="14"></td><td><pre>		- SOCK_DGRAM: 数据报套接字</pre></td></tr><tr><td data-num="15"></td><td><pre>		- SOCK_SEQPACKET: 允许分组套接字</pre></td></tr><tr><td data-num="16"></td><td><pre>		- SOCK_RAW: 原始套接字</pre></td></tr><tr><td data-num="17"></td><td><pre>	protocal: 协议类型，或者设置为 0（会选择 domain 和 type 组合的系统默认值，但是并非所有的组合都是有效的）</pre></td></tr><tr><td data-num="18"></td><td><pre>		- IPPROTO_TCP:TCP 传输协议</pre></td></tr><tr><td data-num="19"></td><td><pre>		- IPPROTO_UPD:UDP 传输协议</pre></td></tr><tr><td data-num="20"></td><td><pre>		- IPPROTO_SCTP:SCTP 传输协议</pre></td></tr><tr><td data-num="21"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="22"></td><td><pre>	socket 函数成功则会返回一个小的非负整数值，它与文件描述符类似，称为套接字描述符 ssocket descriptor（sockfd）。失败则返回 - 1</pre></td></tr><tr><td data-num="23"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="connect函数"><a class="anchor" href="#connect函数">#</a> connect 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> socklen_t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>serveraddr<span class="token punctuation">,</span> socklen_t addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="5"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="6"></td><td><pre>Description:</pre></td></tr><tr><td data-num="7"></td><td><pre>	sockfd: 客户端用于通信的套接字描述符；</pre></td></tr><tr><td data-num="8"></td><td><pre>	serveraddr: 服务器监听套接字</pre></td></tr><tr><td data-num="9"></td><td><pre>	addrlen: 服务器套接字地址结构长度</pre></td></tr><tr><td data-num="10"></td><td><pre>	客户在调用函数 connect 之前，不必非得调用 bind 函数；因为如果也需要的话，内核会确定源 IP 地址，并选择一个临时端口作为源端口</pre></td></tr><tr><td data-num="11"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="12"></td><td><pre>	若成功则返回 0，若出错则返回 - 1。若 connect 失败则该套接字不再可用，必须关闭。</pre></td></tr><tr><td data-num="13"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="bind函数"><a class="anchor" href="#bind函数">#</a> bind 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>myaddr<span class="token punctuation">,</span> socklen_t addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="4"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="5"></td><td><pre>Description:</pre></td></tr><tr><td data-num="6"></td><td><pre>	把一个本地协议地址赋予一个套接字</pre></td></tr><tr><td data-num="7"></td><td><pre>	sockfd:</pre></td></tr><tr><td data-num="8"></td><td><pre>	myaddr:</pre></td></tr><tr><td data-num="9"></td><td><pre>	socklen_t:</pre></td></tr><tr><td data-num="10"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="listen函数"><a class="anchor" href="#listen函数">#</a> listen 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> backlog<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="4"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="5"></td><td><pre>Description:</pre></td></tr><tr><td data-num="6"></td><td><pre>	sockfd: 套接字描述符；当 socket 函数创建一个套接字时，它被假设为一个主动套接字，listen 函数把一个未连接的套接字转化为一个被动套接字，指示内核应该接受指向该套接字的连接请求；（调用 listen 导致套接字从 CLOSE 状态转换到 LISTEN 状态）</pre></td></tr><tr><td data-num="7"></td><td><pre>	backlog: 内核应该为相应套接字设置的最大排队连接请求</pre></td></tr><tr><td data-num="8"></td><td><pre>Return Value：</pre></td></tr><tr><td data-num="9"></td><td><pre>	若成功则返回 0，若失败返回 - 1；</pre></td></tr><tr><td data-num="10"></td><td><pre>*/</pre></td></tr></table></figure><p>内核会为任何一个给定的监听套接字维护两个队列：</p><ul><li>未完成连接队列（incomplete connection queue）</li><li>已完成连接队列（completed connection queue）</li></ul><h3 id="accept函数"><a class="anchor" href="#accept函数">#</a> accept 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>clientaddr<span class="token punctuation">,</span> socklen_t addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="4"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="5"></td><td><pre>Description:</pre></td></tr><tr><td data-num="6"></td><td><pre>	accept 函数由 TCP 服务器调用，用于从已完成连接队列对头返回下一个已完成连接的客户端请求。如果已完成连接队列为空，那么进程被置于休眠状态。</pre></td></tr><tr><td data-num="7"></td><td><pre>	sockfd: 监听套接字描述符</pre></td></tr><tr><td data-num="8"></td><td><pre>	clientaddr: 客户进程地址结构</pre></td></tr><tr><td data-num="9"></td><td><pre>	addrlen: 客户进程协议地址长度</pre></td></tr><tr><td data-num="10"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="11"></td><td><pre>	若 accept 成功，那么其返回值是由内核自动生成的一个全新的套接字描述符，代表与所返回的客户的 TCP 连接。若服务器对客户协议地址不感兴趣，可以把 clientaddr 和 addrlen 设置为空指针。返回的已连接套接字在每次断开连接后需要关闭。若失败则返回 - 1；</pre></td></tr><tr><td data-num="12"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="recv和send函数"><a class="anchor" href="#recv和send函数">#</a> recv 和 send 函数</h3><p><code>recv</code> 和 <code>send</code> 函数类似于标准的 <code>read</code> 和 <code>write</code> 函数，不过需要一个额外的参数。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">int</span> ssize_t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> size_t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ssize_t <span class="token function">recv</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buff<span class="token punctuation">,</span> size_t nbytes<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ssize_t <span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">int</span> socket<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buff<span class="token punctuation">,</span> size_t nbytes<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="7"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="8"></td><td><pre>Description:</pre></td></tr><tr><td data-num="9"></td><td><pre>	前三个参数等同于 read 和 write 的三个参数。flags 参数的值或为 0，或为如下字段：</pre></td></tr><tr><td data-num="10"></td><td><pre>		- MSG_DONTROUTE</pre></td></tr><tr><td data-num="11"></td><td><pre>		- MSG_DONTWAIT</pre></td></tr><tr><td data-num="12"></td><td><pre>		- MSG_OOB</pre></td></tr><tr><td data-num="13"></td><td><pre>		- MSG_PEEK</pre></td></tr><tr><td data-num="14"></td><td><pre>		- MSG_WAITALL</pre></td></tr><tr><td data-num="15"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="close函数"><a class="anchor" href="#close函数">#</a> close 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="4"></td><td><pre>	#include &lt;unistd.h></pre></td></tr><tr><td data-num="5"></td><td><pre>Description:</pre></td></tr><tr><td data-num="6"></td><td><pre>	sockfd: 待关闭的套接字描述符</pre></td></tr><tr><td data-num="7"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="8"></td><td><pre>	若关闭成功返回 0，若关闭失败返回 - 1；</pre></td></tr><tr><td data-num="9"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="并发服务器"><a class="anchor" href="#并发服务器">#</a> 并发服务器</h3><p>当服务器需要连接多个客户端时，可以使用迭代的方式，但是当服务一个客户请求可能花费较长时间时，我们并不希望整个服务器被单个客户长期占用，而是希望同时服务多个客户，这时需要在并发的服务器。</p><h2 id="tcp客户服务器程序实例"><a class="anchor" href="#tcp客户服务器程序实例">#</a> TCP 客户 / 服务器程序实例</h2><p>&lt;img src=&quot;C:\Users\Value\AppData\Roaming\Typora\typora-user-images\image-20230522145338069.png&quot; alt=&quot;image-20230522145338069&quot; style=&quot;zoom:90%;&quot; /&gt;</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* 服务端 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//============================================================================</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Name        : learning_socket.cpp</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// Author      : Value</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// Version     :</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// Copyright   : Your copyright notice</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// Description : Hello World in C++, Ansi-style</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//============================================================================</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token comment">/* 创建监听套接字描述符 */</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">int</span> listen_socket_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token comment">/* 监听套接字地址结构 */</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> listen_socket<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	listen_socket<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	listen_socket<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token function">inet_pton</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> <span class="token string">"192.168.159.130"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>listen_socket<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token comment">/* 绑定 IP 和 Port */</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">bind</span><span class="token punctuation">(</span>listen_socket_fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>listen_socket<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> listen_socket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token comment">/* 监听 */</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	ret <span class="token operator">=</span> <span class="token function">listen</span><span class="token punctuation">(</span>listen_socket_fd<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"listen error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"客户端启动中...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token comment">/* 等待客户端；连接 */</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_socket<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> addrlen <span class="token operator">=</span> <span class="token keyword">sizeof</span> client_socket<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token keyword">int</span> client_socket_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>listen_socket_fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>client_socket<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>client_socket_fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"accept error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token keyword">char</span> ip<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"客户端IP：%s, 端口：%d\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>			<span class="token function">inet_ntop</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> <span class="token operator">&amp;</span>client_socket<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> ip<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>			<span class="token function">ntohs</span><span class="token punctuation">(</span>client_socket<span class="token punctuation">.</span>sin_port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>	<span class="token comment">/* 通信 */</span></pre></td></tr><tr><td data-num="51"></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>		<span class="token comment">/* 接收数据 */</span></pre></td></tr><tr><td data-num="53"></td><td><pre>		<span class="token keyword">char</span> buff<span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>		<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>client_socket_fd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"received client messages:%s\n"</span><span class="token punctuation">,</span> buff<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>			<span class="token comment">/* 发送消息 */</span></pre></td></tr><tr><td data-num="58"></td><td><pre>			<span class="token function">send</span><span class="token punctuation">(</span>client_socket_fd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"客户端断开了连接..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"recv error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>client_socket_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>listen_socket_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* 客户端 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//============================================================================</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Name        : learning_client.cpp</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// Author      : Value</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// Version     :</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// Copyright   : Your copyright notice</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// Description : Hello World in C++, Ansi-style</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//============================================================================</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token comment">/* 创建通信套接字描述符 */</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">int</span> client_socket_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>client_socket_fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket error!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token comment">/* 客户端可绑定固定 IP 和端口，也可以不绑定，操作系统自动选择空闲端口和本地 IP */</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token function">inet_pton</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> <span class="token string">"192.168.159.130"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token comment">/* 连接服务器 */</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>client_socket_fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"connect error!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token comment">/* 通信 */</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"连接成功！\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>		<span class="token keyword">char</span> buff<span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		<span class="token comment">/* 发送数据 */</span></pre></td></tr><tr><td data-num="39"></td><td><pre>		<span class="token function">sprintf</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> <span class="token string">"你好，我是客户端！发送给你%d\n"</span><span class="token punctuation">,</span>count <span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>		<span class="token function">send</span><span class="token punctuation">(</span>client_socket_fd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>		<span class="token comment">/* 接收数据 */</span></pre></td></tr><tr><td data-num="42"></td><td><pre>		<span class="token function">memset</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> buff<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>		<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>client_socket_fd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"受到数据：%s\n"</span><span class="token punctuation">,</span> buff<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"服务器断开了连接...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"recv error!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>client_socket_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="udp套接字编程"><a class="anchor" href="#udp套接字编程">#</a> UDP 套接字编程</h2><h3 id="recvfrom和sendto函数"><a class="anchor" href="#recvfrom和sendto函数">#</a> recvfrom 和 sendto 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>ssize_t <span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buff<span class="token punctuation">,</span> size_t nbytes<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>from<span class="token punctuation">,</span> socklen_t <span class="token operator">*</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="4"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="5"></td><td><pre>Description:</pre></td></tr><tr><td data-num="6"></td><td><pre>	sockfd: 用于通信的套接字描述符</pre></td></tr><tr><td data-num="7"></td><td><pre>	buff: 指向读入缓冲区的指针</pre></td></tr><tr><td data-num="8"></td><td><pre>	nbytes:</pre></td></tr><tr><td data-num="9"></td><td><pre>	flags:</pre></td></tr><tr><td data-num="10"></td><td><pre>	from: 指向数据报发送者的协议地址的套接字地址结构</pre></td></tr><tr><td data-num="11"></td><td><pre>	addrlen: 套接字地址结构大小</pre></td></tr><tr><td data-num="12"></td><td><pre>	</pre></td></tr><tr><td data-num="13"></td><td><pre>*/</pre></td></tr><tr><td data-num="14"></td><td><pre>ssize_t <span class="token function">sendto</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buff<span class="token punctuation">,</span> size_t nbytes<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>to<span class="token punctuation">,</span> socklen_t addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="16"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="17"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="18"></td><td><pre>Description:</pre></td></tr><tr><td data-num="19"></td><td><pre>	sockfd: 用于通信的</pre></td></tr><tr><td data-num="20"></td><td><pre>	buff:</pre></td></tr><tr><td data-num="21"></td><td><pre>	nbytes:</pre></td></tr><tr><td data-num="22"></td><td><pre>	flags:</pre></td></tr><tr><td data-num="23"></td><td><pre>	to: 指向数据报接受者的协议地址（IP 地址以端口号）的套接字地址结构</pre></td></tr><tr><td data-num="24"></td><td><pre>	addrlen: 套接字地址结构大小</pre></td></tr><tr><td data-num="25"></td><td><pre>*/</pre></td></tr></table></figure><h2 id="高级io函数"><a class="anchor" href="#高级io函数">#</a> 高级 I/O 函数</h2><h3 id="套接字超时"><a class="anchor" href="#套接字超时">#</a> 套接字超时</h3><h3 id="readv和writev函数"><a class="anchor" href="#readv和writev函数">#</a> readv 和 writev 函数</h3><p>这两个函数类似于 <code>read</code> 和 <code>write</code> ，不过 <code>readv</code> 和 <code>writev</code> 允许单个系统嗲用读入或写入一个或多个缓冲区。</p><h3 id="recvmsg和sendmsg函数"><a class="anchor" href="#recvmsg和sendmsg函数">#</a> recvmsg 和 sendmsg 函数</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>ssize_t <span class="token function">recvmsg</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> msghdr <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ssize_t <span class="token function">sendmsg</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> msghdr <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">msghdr</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">void</span> <span class="token operator">*</span>msg_name<span class="token punctuation">;</span>		<span class="token comment">/* Address to send to/receive from.  */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    socklen_t msg_namelen<span class="token punctuation">;</span>	<span class="token comment">/* Length of address data.  */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">iovec</span> <span class="token operator">*</span>msg_iov<span class="token punctuation">;</span>	<span class="token comment">/* Vector of data to send/receive into.  */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    size_t msg_iovlen<span class="token punctuation">;</span>		<span class="token comment">/* Number of elements in the vector.  */</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">void</span> <span class="token operator">*</span>msg_control<span class="token punctuation">;</span>		<span class="token comment">/* Ancillary data (eg BSD filedesc passing). */</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    size_t msg_controllen<span class="token punctuation">;</span>	<span class="token comment">/* Ancillary data buffer length.</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                   !! The type should be socklen_t but the</pre></td></tr><tr><td data-num="11"></td><td><pre>                   definition of the kernel is incompatible</pre></td></tr><tr><td data-num="12"></td><td><pre>                   with this.  */</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">int</span> msg_flags<span class="token punctuation">;</span>		<span class="token comment">/* Flags on received message.  */</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="16"></td><td><pre>Synopsis:</pre></td></tr><tr><td data-num="17"></td><td><pre>	#include &lt;sys/socket.h></pre></td></tr><tr><td data-num="18"></td><td><pre>Description:</pre></td></tr><tr><td data-num="19"></td><td><pre>	</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>Return Value:</pre></td></tr><tr><td data-num="22"></td><td><pre>*/</pre></td></tr></table></figure><h3 id="辅助数据"><a class="anchor" href="#辅助数据">#</a> 辅助数据</h3><div class="tags"><a href="/tags/C/" rel="tag"><i class="ic i-tag"></i> C++</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2024-03-11 14:17:25" itemprop="dateModified" datetime="2024-03-11T14:17:25+08:00">2024-03-11</time> </span><span id="value/Unix programing.html" class="item leancloud_visitors" data-flag-title="UNIX网络编程" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="Value WeChat Pay"><p>WeChat Pay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Value <i class="ic i-at"><em>@</em></i>繁華落盡 似水流年</li><li class="link"><strong>Post link: </strong><a href="http://example.com/value/Unix%20programing" title="UNIX网络编程">http://example.com/value/Unix programing</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"></div><div class="item right"><a href="/value/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/least%20squares%20method" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;dogefs.s3.ladydaily.com&#x2F;~&#x2F;source&#x2F;unsplash&#x2F;photo-1656531231697-4084cb4b91f3?q&#x3D;80&amp;w&#x3D;1935&amp;auto&#x3D;format&amp;fit&#x3D;crop&amp;ixlib&#x3D;rb-4.0.3&amp;ixid&#x3D;M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" title="最小二乘法"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> Mathematical methods</span><h3>最小二乘法</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82tcp-udp%E5%92%8Csctp"><span class="toc-number">1.</span> <span class="toc-text">传输层：TCP、UDP 和 SCTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">套接字编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">套接字地址结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ipv4%E5%A5%97%E6%8E%A5%E5%AD%97%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">IPV4 套接字地址结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ipv6%E5%A5%97%E6%8E%A5%E5%AD%97%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.2.</span> <span class="toc-text">IPV6 套接字地址结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC-%E7%BB%93%E6%9E%9C%E5%8F%82%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">值 - 结果参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E6%8E%92%E5%BA%8F%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">字节排序函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E6%93%8D%E7%BA%B5%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">字符操纵函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">地址转换函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readn-writen%E5%92%8Creadline%E5%87%BD%E6%95%B0"><span class="toc-number">2.6.</span> <span class="toc-text">readn、writen 和 readline 函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">TCP 套接字编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#socket%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">socket 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#connect%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">connect 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bind%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.</span> <span class="toc-text">bind 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#listen%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">listen 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#accept%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.</span> <span class="toc-text">accept 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#recv%E5%92%8Csend%E5%87%BD%E6%95%B0"><span class="toc-number">3.6.</span> <span class="toc-text">recv 和 send 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#close%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.</span> <span class="toc-text">close 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">3.8.</span> <span class="toc-text">并发服务器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E5%AE%A2%E6%88%B7%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A8%8B%E5%BA%8F%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.</span> <span class="toc-text">TCP 客户 &#x2F; 服务器程序实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#udp%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">UDP 套接字编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#recvfrom%E5%92%8Csendto%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">recvfrom 和 sendto 函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7io%E5%87%BD%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">高级 I&#x2F;O 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E8%B6%85%E6%97%B6"><span class="toc-number">6.1.</span> <span class="toc-text">套接字超时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readv%E5%92%8Cwritev%E5%87%BD%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">readv 和 writev 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#recvmsg%E5%92%8Csendmsg%E5%87%BD%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">recvmsg 和 sendmsg 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E6%95%B0%E6%8D%AE"><span class="toc-number">6.4.</span> <span class="toc-text">辅助数据</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li class="active"><a href="/value/Unix%20programing" rel="bookmark" title="UNIX网络编程">UNIX网络编程</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Value" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Value</p><div class="description" itemprop="description">编程日记 & 随笔</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">39</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">38</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">29</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NwZWNpYWwtSmlhSGFv" title="https:&#x2F;&#x2F;github.com&#x2F;Special-JiaHao"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTIwNDE4OTkzODk=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;2041899389"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNDMzNDE3NDUwP3NwbV9pZF9mcm9tPTMzMy4zMzcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;433417450?spm_id_from&#x3D;333.337.0.0"><i class="ic i-bilibili"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmpoMTU3NzA5QDE2My5jb20=" title="mailto:jh157709@163.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="In 面试题">面试题</a> <i class="ic i-angle-right"></i> <a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="In 操作系统">操作系统</a></div><span><a href="/value/%E6%A0%A1%E6%8B%9B%E4%B8%8E%E9%9D%A2%E8%AF%95/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%9D%A2%E8%AF%95%E9%A2%98" title="操作系统面试题">操作系统面试题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="In 面试题">面试题</a> <i class="ic i-angle-right"></i> <a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/MySQL/" title="In MySQL">MySQL</a></div><span><a href="/value/%E6%A0%A1%E6%8B%9B%E4%B8%8E%E9%9D%A2%E8%AF%95/MySQL%E9%9D%A2%E8%AF%95%E9%A2%98" title="MySQL面试题">MySQL面试题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="In Algorithm">Algorithm</a></div><span><a href="/value/Algorithm/%E4%BA%8C%E5%88%86" title="二分">二分</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Machine-Learning/" title="In Machine Learning">Machine Learning</a> <i class="ic i-angle-right"></i> <a href="/categories/Machine-Learning/Mathematical-methods/" title="In Mathematical methods">Mathematical methods</a></div><span><a href="/value/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Graident%20descent" title="梯度下降">梯度下降</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPP/" title="In C++">C++</a> <i class="ic i-angle-right"></i> <a href="/categories/CPP/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/" title="In 数据库连接池">数据库连接池</a></div><span><a href="/value/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0" title="数据库连接池(C++)">数据库连接池(C++)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPP/" title="In C++">C++</a> <i class="ic i-angle-right"></i> <a href="/categories/CPP/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="In 多线程">多线程</a></div><span><a href="/value/CPP/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B" title="多线程编程">多线程编程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="In 算法">算法</a></div><span><a href="/value/%E7%AE%97%E6%B3%95%E6%A8%A1%E7%89%88" title="算法模版">算法模版</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPP/" title="In C++">C++</a> <i class="ic i-angle-right"></i> <a href="/categories/CPP/STL/" title="In STL">STL</a></div><span><a href="/value/CPP/stl_list" title="STL List">STL List</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%A0%A1%E6%8B%9B/" title="In 校招">校招</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%A0%A1%E6%8B%9B/%E5%B0%8F%E7%BA%A2%E4%B9%A6/" title="In 小红书">小红书</a></div><span><a href="/value/%E6%A0%A1%E6%8B%9B%E4%B8%8E%E9%9D%A2%E8%AF%95/%E5%B0%8F%E7%BA%A2%E4%B9%A6%E6%A0%A1%E6%8B%9B" title="小红书校招">小红书校招</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Unix/" title="In Unix">Unix</a></div><span><a href="/value/Unix%20programing" title="UNIX网络编程">UNIX网络编程</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Value @ Value's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">163k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">2:28</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"value/Unix programing.html",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->