<!-- build time:Wed Jul 24 2024 15:12:28 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="繁華落盡 似水流年" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="繁華落盡 似水流年" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="繁華落盡 似水流年" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Python"><link rel="canonical" href="http://example.com/value/Python/grpc%20for%20python.html"><title>gRPC for Python - gRPC - Python | Value's Blog = 繁華落盡 似水流年 = 寄予厚望 还请善待</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">gRPC for Python</h1><div class="meta"><span class="item" title="Created: 2024-04-10 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-04-10T00:00:00+08:00">2024-04-10</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>3.4k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>3 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Value's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://raw.githubusercontent.com/Special-JiaHao/images/main/gRPC.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Python/" itemprop="item" rel="index" title="In Python"><span itemprop="name">Python</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Python/gRPC/" itemprop="item" rel="index" title="In gRPC"><span itemprop="name">gRPC</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://example.com/value/Python/grpc%20for%20python"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Value"><meta itemprop="description" content="寄予厚望 还请善待, 编程日记 & 随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="繁華落盡 似水流年"></span><div class="body md" itemprop="articleBody"><h2 id="grpc介绍"><a class="anchor" href="#grpc介绍">#</a> <code>gRPC</code> 介绍</h2><blockquote><p>“gRPC is a modern open source high performance RPC framework that can run in any environment. It can efficiently connect services in and across data centers with pluggable support for load balancing, tracing, health checking and authentication. It is also applicable in last mile of distributed computing to connect devices, mobile applications and browsers to backend services.”</p></blockquote><ul><li>On the server side, the server implements this interface and runs a gRPC server to handle client calls.</li><li>On the client side, the client has a stub (referred to as just a client in some languages) that provides the same methods as the server.</li></ul><p><img data-src="https://grpc.io/img/landing-2.svg" alt=""></p><h2 id="环境搭建"><a class="anchor" href="#环境搭建">#</a> 环境搭建</h2><ol><li><p>创建一个用于 <code>gRPC</code> 的虚拟环境</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>conda create <span class="token parameter variable">-n</span> grcp_py <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.10</span></pre></td></tr></table></figure></li><li><p>激活虚拟环境，并进入到项目目录下方</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>conda activate grpc_py</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> grpc</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">cd</span> grpc</pre></td></tr></table></figure></li><li><p>安装 <code>gRPC</code> 第三方库及其依赖</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>pip <span class="token function">install</span> grpcio</pre></td></tr><tr><td data-num="2"></td><td><pre>pip <span class="token function">install</span> grpcio-tools</pre></td></tr></table></figure></li></ol><h2 id="示例一-helloworld"><a class="anchor" href="#示例一-helloworld">#</a> 示例一: HelloWorld</h2><h3 id="功能"><a class="anchor" href="#功能">#</a> 功能</h3><ul><li>客户端调用服务端</li></ul><h3 id="protobuf协议结构"><a class="anchor" href="#protobuf协议结构">#</a> protobuf 协议结构</h3><figure class="highlight protobuf"><figcaption data-lang="Protocol Buffers"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">"proto3"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">package</span> helloworld<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// The greeting service definition.</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">service</span> <span class="token class-name">Greeter</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">//  远程过程调用的接口</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">rpc</span> <span class="token function">SayHello</span> <span class="token punctuation">(</span><span class="token class-name">HelloRequest</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token class-name">HelloReply</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>	<span class="token comment">// 调用 SayHello ()</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 交互的消息体</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">message</span> <span class="token class-name">HelloRequest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">message</span> <span class="token class-name">HelloReply</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token builtin">string</span> message <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="简单的客户端-服务端"><a class="anchor" href="#简单的客户端-服务端">#</a> 简单的客户端、服务端</h3><ul><li><strong>服务端</strong></li></ul><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> concurrent <span class="token keyword">import</span> futures	<span class="token comment"># 提供线程池</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> grpc</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> helloworld_pb2</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> helloworld_pb2_grpc</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span>helloworld_pb2_grpc<span class="token punctuation">.</span>GreeterServicer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> helloworld_pb2<span class="token punctuation">.</span>HelloReply<span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">"Hello, %s!"</span> <span class="token operator">%</span> request<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    port <span class="token operator">=</span> <span class="token string">"50051"</span>	<span class="token comment"># 服务端的端口号</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    server <span class="token operator">=</span> grpc<span class="token punctuation">.</span>server<span class="token punctuation">(</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment"># 创建 grpc 服务端对象</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    helloworld_pb2_grpc<span class="token punctuation">.</span>add_GreeterServicer_to_server<span class="token punctuation">(</span>Greeter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span>	<span class="token comment"># 将重写的服务接口注册到当前服务器上</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    server<span class="token punctuation">.</span>add_insecure_port<span class="token punctuation">(</span><span class="token string">"[::]:"</span> <span class="token operator">+</span> port<span class="token punctuation">)</span>	<span class="token comment"># 设置端口</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    server<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment"># 开启服务，多线程开启</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Server started, listening on "</span> <span class="token operator">+</span> port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    server<span class="token punctuation">.</span>wait_for_termination<span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment"># 堵塞</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    serve<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><ul><li><strong>客户端</strong></li></ul><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> grpc</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> helloworld_pb2</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> helloworld_pb2_grpc</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Will try to greet world ..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">with</span> grpc<span class="token punctuation">.</span>insecure_channel<span class="token punctuation">(</span><span class="token string">"服务端ip:服务端端口"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> channel<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        stub <span class="token operator">=</span> helloworld_pb2_grpc<span class="token punctuation">.</span>GreeterStub<span class="token punctuation">(</span>channel<span class="token punctuation">)</span>		<span class="token comment"># 调用 GreeterStub 方法去调用远程计算机的 Greeter 服务</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        response <span class="token operator">=</span> stub<span class="token punctuation">.</span>SayHello<span class="token punctuation">(</span>helloworld_pb2<span class="token punctuation">.</span>HelloRequest<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"you"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment"># 调用 Greeter 服务下的 SayHello 方法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Greeter client received: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>message<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="with-flection"><a class="anchor" href="#with-flection">#</a> with flection</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>pip <span class="token function">install</span> grpcio-reflection</pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> concurrent <span class="token keyword">import</span> futures</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> grpc</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> grpc_reflection<span class="token punctuation">.</span>v1alpha <span class="token keyword">import</span> reflection</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> helloworld_pb2</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> helloworld_pb2_grpc</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span>helloworld_pb2_grpc<span class="token punctuation">.</span>GreeterServicer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> helloworld_pb2<span class="token punctuation">.</span>HelloReply<span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">"Hello, %s!"</span> <span class="token operator">%</span> request<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">def</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    server <span class="token operator">=</span> grpc<span class="token punctuation">.</span>server<span class="token punctuation">(</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    helloworld_pb2_grpc<span class="token punctuation">.</span>add_GreeterServicer_to_server<span class="token punctuation">(</span>Greeter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    SERVICE_NAMES <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        helloworld_pb2<span class="token punctuation">.</span>DESCRIPTOR<span class="token punctuation">.</span>services_by_name<span class="token punctuation">[</span><span class="token string">"Greeter"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>full_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        reflection<span class="token punctuation">.</span>SERVICE_NAME<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    reflection<span class="token punctuation">.</span>enable_server_reflection<span class="token punctuation">(</span>SERVICE_NAMES<span class="token punctuation">,</span> server<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    server<span class="token punctuation">.</span>add_insecure_port<span class="token punctuation">(</span><span class="token string">"[::]:50051"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    server<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    server<span class="token punctuation">.</span>wait_for_termination<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    serve<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="异步客户端-服务端"><a class="anchor" href="#异步客户端-服务端">#</a> 异步客户端、服务端</h3><ul><li><strong>服务端</strong></li></ul><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> asyncio</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> grpc</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> helloworld_pb2</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> helloworld_pb2_grpc</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span>helloworld_pb2_grpc<span class="token punctuation">.</span>GreeterServicer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">SayHello</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        self<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        request<span class="token punctuation">:</span> helloworld_pb2<span class="token punctuation">.</span>HelloRequest<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        context<span class="token punctuation">:</span> grpc<span class="token punctuation">.</span>aio<span class="token punctuation">.</span>ServicerContext<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> helloworld_pb2<span class="token punctuation">.</span>HelloReply<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> helloworld_pb2<span class="token punctuation">.</span>HelloReply<span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">"Hello, %s!"</span> <span class="token operator">%</span> request<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    server <span class="token operator">=</span> grpc<span class="token punctuation">.</span>aio<span class="token punctuation">.</span>server<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    helloworld_pb2_grpc<span class="token punctuation">.</span>add_GreeterServicer_to_server<span class="token punctuation">(</span>Greeter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    listen_addr <span class="token operator">=</span> <span class="token string">"[::]:50051"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    server<span class="token punctuation">.</span>add_insecure_port<span class="token punctuation">(</span>listen_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Starting server on %s"</span><span class="token punctuation">,</span> listen_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">await</span> server<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">await</span> server<span class="token punctuation">.</span>wait_for_termination<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>serve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="参考"><a class="anchor" href="#参考">#</a> 参考</h2><ul><li>[1] <span class="exturl" data-url="aHR0cHM6Ly9ncnBjLmlvL2RvY3MvbGFuZ3VhZ2VzL3B5dGhvbi9xdWlja3N0YXJ0Lw==">gRPC</span></li><li>[2] [Github for gRPC][<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYw==">https://github.com/grpc/grpc</span>]</li></ul><div class="tags"><a href="/tags/Python/" rel="tag"><i class="ic i-tag"></i> Python</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2024-05-02 10:37:03" itemprop="dateModified" datetime="2024-05-02T10:37:03+08:00">2024-05-02</time> </span><span id="value/Python/grpc for python.html" class="item leancloud_visitors" data-flag-title="gRPC for Python" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="Value WeChat Pay"><p>WeChat Pay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Value <i class="ic i-at"><em>@</em></i>繁華落盡 似水流年</li><li class="link"><strong>Post link: </strong><a href="http://example.com/value/Python/grpc%20for%20python" title="gRPC for Python">http://example.com/value/Python/grpc for python</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/value/grpc%20for%20C++" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;dogefs.s3.ladydaily.com&#x2F;~&#x2F;source&#x2F;unsplash&#x2F;photo-1656531231697-4084cb4b91f3?q&#x3D;80&amp;w&#x3D;1935&amp;auto&#x3D;format&amp;fit&#x3D;crop&amp;ixlib&#x3D;rb-4.0.3&amp;ixid&#x3D;M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" title="GRPC for C++"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> grpc</span><h3>GRPC for C++</h3></a></div><div class="item right"><a href="/value/CPP/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;browser9.qhimg.com&#x2F;bdr&#x2F;__85&#x2F;t016ad88ddaf2ae2d92.jpg" title="IO多路复用"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> C++</span><h3>IO多路复用</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#grpc%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">gRPC 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%B8%80-helloworld"><span class="toc-number">3.</span> <span class="toc-text">示例一: HelloWorld</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD"><span class="toc-number">3.1.</span> <span class="toc-text">功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#protobuf%E5%8D%8F%E8%AE%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.</span> <span class="toc-text">protobuf 协议结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.3.</span> <span class="toc-text">简单的客户端、服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#with-flection"><span class="toc-number">3.4.</span> <span class="toc-text">with flection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.5.</span> <span class="toc-text">异步客户端、服务端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li class="active"><a href="/value/Python/grpc%20for%20python" rel="bookmark" title="gRPC for Python">gRPC for Python</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Value" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Value</p><div class="description" itemprop="description">编程日记 & 随笔</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">50</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">49</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">34</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NwZWNpYWwtSmlhSGFv" title="https:&#x2F;&#x2F;github.com&#x2F;Special-JiaHao"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTIwNDE4OTkzODk=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;2041899389"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNDMzNDE3NDUwP3NwbV9pZF9mcm9tPTMzMy4zMzcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;433417450?spm_id_from&#x3D;333.337.0.0"><i class="ic i-bilibili"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmpoMTU3NzA5QDE2My5jb20=" title="mailto:jh157709@163.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/value/grpc%20for%20C++" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/value/CPP/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E6%A0%A1%E6%8B%9B/" title="In 校招">校招</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%A0%A1%E6%8B%9B/%E8%9A%82%E8%9A%81%E9%9B%86%E5%9B%A2/" title="In 蚂蚁集团">蚂蚁集团</a></div><span><a href="/value/%E6%A0%A1%E6%8B%9B%E4%B8%8E%E9%9D%A2%E8%AF%95/%E8%9A%82%E8%9A%81%E9%9B%86%E5%9B%A2%E6%A0%A1%E6%8B%9B" title="蚂蚁集团校招">蚂蚁集团校招</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="In 面试题">面试题</a> <i class="ic i-angle-right"></i> <a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="In 计算机网络">计算机网络</a></div><span><a href="/value/%E6%A0%A1%E6%8B%9B%E4%B8%8E%E9%9D%A2%E8%AF%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95%E9%A2%98" title="计算机网络面试题">计算机网络面试题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPP/" title="In C++">C++</a> <i class="ic i-angle-right"></i> <a href="/categories/CPP/C-11/" title="In C++11">C++11</a></div><span><a href="/value/CPP/C++11" title="C++11新特性">C++11新特性</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Code/" title="In Code">Code</a> <i class="ic i-angle-right"></i> <a href="/categories/Code/Leetcode/" title="In Leetcode">Leetcode</a></div><span><a href="/value/Code/%E7%AC%AC390%E5%9C%BA%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3" title="第 390 场周赛">第 390 场周赛</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPP/" title="In C++">C++</a> <i class="ic i-angle-right"></i> <a href="/categories/CPP/STL/" title="In STL">STL</a></div><span><a href="/value/CPP/stl_list" title="STL List">STL List</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="In 数据库">数据库</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/" title="In Redis">Redis</a></div><span><a href="/value/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E5%9F%BA%E7%A1%80" title="Redis基础">Redis基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="In 面试题">面试题</a> <i class="ic i-angle-right"></i> <a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="In 操作系统">操作系统</a></div><span><a href="/value/%E6%A0%A1%E6%8B%9B%E4%B8%8E%E9%9D%A2%E8%AF%95/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%9D%A2%E8%AF%95%E9%A2%98" title="操作系统面试题">操作系统面试题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="In Algorithm">Algorithm</a></div><span><a href="/value/Algorithm/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95" title="扩展欧几里得算法">扩展欧几里得算法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%A0%A1%E6%8B%9B/" title="In 校招">校招</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%A0%A1%E6%8B%9B/%E5%B0%8F%E7%BA%A2%E4%B9%A6/" title="In 小红书">小红书</a></div><span><a href="/value/%E6%A0%A1%E6%8B%9B%E4%B8%8E%E9%9D%A2%E8%AF%95/%E5%B0%8F%E7%BA%A2%E4%B9%A6%E6%A0%A1%E6%8B%9B" title="小红书校招">小红书校招</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Mearning-Learning/" title="In Mearning Learning">Mearning Learning</a></div><span><a href="/value/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9CCNN" title="Convolutional Neural Network">Convolutional Neural Network</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Value @ Value's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">189k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">2:52</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"value/Python/grpc for python.html",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->