<!-- build time:Wed Mar 06 2024 10:32:20 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="繁華落盡 似水流年" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="繁華落盡 似水流年" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="繁華落盡 似水流年" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="数据库"><link rel="canonical" href="http://example.com/value/redis.html"><title>redis - 数据库 | Value's Blog = 繁華落盡 似水流年 = 寄予厚望 还请善待</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">redis</h1><div class="meta"><span class="item" title="Created: 2023-10-03 16:18:31"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2023-10-03T16:18:31+08:00">2023-10-03</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>5.3k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>5 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Value's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://images.wallpaperscraft.com/image/single/light_neon_inscription_134108_1280x720.jpg"></li><li class="item" data-background-image="https://dogefs.s3.ladydaily.com/~/source/unsplash/photo-1682687221006-b7fd60cf9dd0?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDF8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"></li><li class="item" data-background-image="https://images.wallpaperscraft.com/image/single/tokyo_night_city_skyscrapers_121628_1280x720.jpg"></li><li class="item" data-background-image="https://images.wallpaperscraft.com/image/single/city_aerial_view_road_156925_1280x720.jpg"></li><li class="item" data-background-image="https://dogefs.s3.ladydaily.com/~/source/unsplash/photo-1682453040852-8d7cd82e74ce?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"></li><li class="item" data-background-image="https://dogefs.s3.ladydaily.com/~/source/unsplash/photo-1597654757564-dae56cf44443?q=80&w=1926&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="item" rel="index" title="In 数据库"><span itemprop="name">数据库</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://example.com/value/redis"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Value"><meta itemprop="description" content="寄予厚望 还请善待, 编程日记 & 随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="繁華落盡 似水流年"></span><div class="body md" itemprop="articleBody"><h1 id="redis"><a class="anchor" href="#redis">#</a> Redis</h1><p>redis（Remote dictionary server）是一个开源的基于内存的数据存储系统。它可以用于数据库缓存，消息队列等各种场景，是一种 NoSQL 数据库。早期的互联网公司系统大多是通过 Mysql 这种传统的关系型数据库对外提供服务。随着互联网的快速发展，应用系统的访问量原来远大，数据库的性能瓶颈越来越明显，主要是由于磁盘 IO 所导致的，磁盘 IO 的读写速度与内存相比是非常慢的，如果能把数据存储在内存中，则可以大大数据存储的性能。于是便出现了 redis，这种基于内存的数据存储系统。</p><p>redis 支持多种数据结构，包括五种基本数据类型和五种高级数据类型。</p><p>五种基本数据类型：</p><ul><li>字符串 String</li><li>列表 List</li><li>集合 Set</li><li>有序集合 SortedSet</li><li>哈希 Hash</li></ul><p>五种高级数据类型：</p><ul><li>消息队列</li><li>地理空间</li><li>HyperLogLog</li><li>位图 Bitmap</li><li>位域 Bitfiled</li></ul><p>redis 的使用方式有三种：</p><ul><li>CLI，命令行界面（Command Line Interface）；通过 Redis-CLI 命令行工具来使用</li><li>API，应用程序接口（Application Programing Interface）；</li><li>GUI，图形用户界面（Graphical User Interface）；通过图形化工具来使用 Redis</li></ul><p>redis 中的数据是以键值对的形式存储的</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 字符串 String</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">set</span> key value      		<span class="token comment"># 设置键值对（key, value）</span></pre></td></tr><tr><td data-num="3"></td><td><pre>get key 	        	<span class="token comment"># 获取 key 对应的 value 值，大小写敏感</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># redis 内默认都是使用字符串来存储数据的，而且是二进制安全的（redis-cli --raw）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>del key			   	    <span class="token comment"># 删除 key 对应的（key，value）键值对</span></pre></td></tr><tr><td data-num="6"></td><td><pre>exists key		    	<span class="token comment"># 判断是否存在 key 对应的键值对</span></pre></td></tr><tr><td data-num="7"></td><td><pre>keys pattern			<span class="token comment"># 查看与 pattern 匹配的键，* 表示所以 key</span></pre></td></tr><tr><td data-num="8"></td><td><pre>flushall		    	<span class="token comment"># 清空数据库，即删除所以的键值对</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">clear</span>			    	<span class="token comment"># 清空屏幕</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 设置一个带过期时间的键值对</span></pre></td></tr><tr><td data-num="11"></td><td><pre>TTL key			   		<span class="token comment"># 查看 key 的过期时间，返回 - 1 表示没有设置过期时间，返回 - 2 表示设置了过期时间同时该键值对已经过期，返回正数表示过期时间</span></pre></td></tr><tr><td data-num="12"></td><td><pre>expire key seconds		<span class="token comment"># 为 key 对应的键值对设置过期时间 seconds</span></pre></td></tr><tr><td data-num="13"></td><td><pre>setex key seconds value  <span class="token comment"># 设置（key，value）键值对的过期时间</span></pre></td></tr><tr><td data-num="14"></td><td><pre>setnx key value			<span class="token comment"># 当键 key 不存在时，插入（key, value）, 否则不插入</span></pre></td></tr></table></figure><p>list 也叫列表，一般用来存储和操作一组有顺序的数据，和数组的概念比较类似</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># lish 操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>lpush key value 		<span class="token comment"># 往列表 key 的左边插入一个 value 的元素</span></pre></td></tr><tr><td data-num="3"></td><td><pre>rpush key value			<span class="token comment"># 往列表 key 的右边插入一个 value 的元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre>lpush key value1 value2 value3 <span class="token punctuation">..</span>.  <span class="token comment"># 一次性添加多个元素</span></pre></td></tr><tr><td data-num="5"></td><td><pre>lrange key start stop	<span class="token comment"># 获取列表 key 左边 [start, stop] 的所以元素索引 0 开始</span></pre></td></tr><tr><td data-num="6"></td><td><pre>lpop key 			   <span class="token comment"># 删除列表 key 最左边的元素，返回删除的元素值</span></pre></td></tr><tr><td data-num="7"></td><td><pre>lpop key count		   <span class="token comment"># 删除列表 key 最左边的 count 个元素（版本 >=6.0.2），返回删除的元素值</span></pre></td></tr><tr><td data-num="8"></td><td><pre>llen key			   <span class="token comment"># 获取列表 key 的长度</span></pre></td></tr><tr><td data-num="9"></td><td><pre>ltrim key start stop    <span class="token comment"># 保留列表 key 从左开始 [stop, stop] 内的元素，范围之外的元素均会被删除（索引均是从 0 开始）</span></pre></td></tr></table></figure><p>set 是一种无序集合，它和列表的区别是列表中的元素都是可以重复的，而 set 中的元素不可以重复，而且 set 中的元素并不像列表中的元素那样都是具有顺序的。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># set 操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>sadd key member			<span class="token comment"># 往无序集合 key 内添加 member 元素，若无序集合 key 内已经存在该 member，则添加失败</span></pre></td></tr><tr><td data-num="3"></td><td><pre>sadd key memeber1 member2 <span class="token punctuation">..</span>.   <span class="token comment"># 往无序集合 key 内添加多个元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre>smembers key			<span class="token comment"># 查看无序集合 key 的元素</span></pre></td></tr><tr><td data-num="5"></td><td><pre>sismember key member	 <span class="token comment"># 查看 member 是否是无序集合 key 内的元素</span></pre></td></tr><tr><td data-num="6"></td><td><pre>srem key memeber		<span class="token comment"># 删除无序集合 key 内的 member</span></pre></td></tr><tr><td data-num="7"></td><td><pre>srem key member1 member2 <span class="token punctuation">..</span>.   <span class="token comment"># 删除无序集合 key 内的多个元素</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 集合运算操作</span></pre></td></tr></table></figure><p>sortedset 是一种有序集合，又名 zset，其和集合的区别在于有序集合的每个元素都会关联一个浮点类型的分数，然后按照这个分数来对集合中的元素进行从小到大的顺序排序，有序集合的成员是唯一的，但是分数是可以重复的。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># sortedset 操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>zadd key score1 member1 score2 member2 <span class="token punctuation">..</span>.  <span class="token comment"># 往有序集合 key 中插入 member1,member2，其对应的分数为 score1, scores2</span></pre></td></tr><tr><td data-num="3"></td><td><pre>zrange key start stop				<span class="token comment"># 查看有序集合 key 内 [start, stop] 内的元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre>zrange key start stop withscores     <span class="token comment"># 查看有序集合 key 内 [start, stop] 内的元素和其对应的分数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>zscore key member				    <span class="token comment"># 获取有序集合 key 内 member 的分数</span></pre></td></tr><tr><td data-num="6"></td><td><pre>zrank key member				    <span class="token comment"># 获取有序集合 key 内 member 的排名（从小到大排序，分数越小排名越高）</span></pre></td></tr><tr><td data-num="7"></td><td><pre>zrevrank key member				    <span class="token comment"># 获取有序集合 key 内 member 的排名（从大到小排序，分数越高排名越高）</span></pre></td></tr></table></figure><p>哈希 hash 是一个字符类型的字段和值的映射表，简单来说就是一个键值对的集合，特别适合用来存储对象。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># hash 操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>hset key field value		<span class="token comment"># 往哈希 key 内插入 (field, value) 键值对</span></pre></td></tr><tr><td data-num="3"></td><td><pre>hget key field			    <span class="token comment"># 获取哈希 key 内 field 对应的值</span></pre></td></tr><tr><td data-num="4"></td><td><pre>hgetall key				   <span class="token comment"># 获取哈希 key 内所以的键值对</span></pre></td></tr><tr><td data-num="5"></td><td><pre>hdel key field  		   <span class="token comment"># 删除哈希 key 内 field 对应的键值</span></pre></td></tr><tr><td data-num="6"></td><td><pre>hexists key field 		    <span class="token comment"># 查看哈希 key 内是否存在 field 对应的键值</span></pre></td></tr><tr><td data-num="7"></td><td><pre>hkeys key				   <span class="token comment"># 获取哈希 key 内所以的键</span></pre></td></tr><tr><td data-num="8"></td><td><pre>hlen key				   <span class="token comment"># 获取哈希 key 内所以键值对的数目</span></pre></td></tr></table></figure><p>redis 提供了发布订阅的功能，可以通过 <code>publish</code> 将消息发布到指定的频道，然后通过 <code>subscribe</code> 命令来订阅这个频道。但是这样的简单的发布和订阅功能具有一些局限性，比如消息无法持久化，无法记录历史消息等等</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>subscribe channel			<span class="token comment"># 订阅频道 channel</span></pre></td></tr><tr><td data-num="2"></td><td><pre>publish channel message		<span class="token comment"># 像频道 channe 发布消息 message</span></pre></td></tr></table></figure><p>消息队列 Stream，是 redis5.0 引入的一个新的数据结构，他是一个轻量级的消息队列，可以实现消息的持久化、记录历史消息等。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Stream 操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>xadd key <span class="token function">id</span> field value				<span class="token comment"># 往消息队列 key 内添加一条消息（消息的 id，消息的内容 (field, value)）， id 为 *，则 redis 则会自动生成，id 为 (时间戳 - 序号) 的形式；redis 自动生成的 id 保证其为递增，如果手动指定 id 需要自己保证插入消息 id 为递增的</span></pre></td></tr><tr><td data-num="3"></td><td><pre>xlen key						   <span class="token comment"># 获取消息队列 key 的消息数目</span></pre></td></tr><tr><td data-num="4"></td><td><pre>xrange key - + 					    <span class="token comment"># 获取消息队列 key 内的所以消息信息</span></pre></td></tr><tr><td data-num="5"></td><td><pre>xrange key start end				<span class="token comment"># 获取消息队列 key 内 id 在 [start, end] 范围内的消息信息</span></pre></td></tr><tr><td data-num="6"></td><td><pre>xdel key <span class="token function">id</span>						    <span class="token comment"># 删除消息队列 key 内 ID 为 id 的消息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>xtrim key maxlen count				<span class="token comment"># 删除消息队列 kye 内的消息，直到消息队列长度为 count（可能比 count 多）</span></pre></td></tr><tr><td data-num="8"></td><td><pre>xread <span class="token punctuation">[</span>count count_num<span class="token punctuation">]</span> <span class="token punctuation">[</span>block milliseconds<span class="token punctuation">]</span> streams key <span class="token function">id</span>   <span class="token comment"># 读取消息队列可以内 count_num 条消息，ID>id，若没有则堵塞 milliseconds 毫秒，如果 id 为 $, 表示获取当前时刻之后的 count_num 条消息</span></pre></td></tr></table></figure><p>地理空间 <code>Genspatial</code> 是 redis3.2 版本的新特性，它提供了一种存储空间位置信息的数据结构，同时支持对地理位置进行的各种计算操作。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 地理空间 genspatial</span></pre></td></tr><tr><td data-num="2"></td><td><pre>geoadd key longitude latitude member 	<span class="token comment"># 往空间地理位置 key 内添加名称为 member 的地理位置信息（经度，纬度）</span></pre></td></tr><tr><td data-num="3"></td><td><pre>geopos key member					  <span class="token comment"># 获取空间地理位置 key 内 member 的位置信息 </span></pre></td></tr><tr><td data-num="4"></td><td><pre>geodist key member1 member2 <span class="token punctuation">[</span>km<span class="token punctuation">]</span>			   <span class="token comment"># 获取空间地理位置 key 内 member1 与 member2 之间的距离，默认为 m</span></pre></td></tr></table></figure><p><code>HyperLogLog</code> 是一种用来做基数统计的算法，它并不是 redis 特有的算法。基数：集合中元素数目（去重之后）。它的原理是使用随机算法来计算，通过牺牲一定的精度来换取更小的内存消耗。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># hyperloglog 操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pfadd key element1 element2 <span class="token punctuation">..</span>.        <span class="token comment"># 往基数容器 key 内添加 element1，element2... 元素</span></pre></td></tr><tr><td data-num="3"></td><td><pre>pfcount key							<span class="token comment"># 获取基数容器 key 内元素的数目</span></pre></td></tr><tr><td data-num="4"></td><td><pre>pfmerge destkey sourcekey1 sourcekey2  <span class="token comment"># 合并多个基数容器，最终存放于 destkey 基数容器内</span></pre></td></tr></table></figure><p>位图是字符串类型的扩展，可以使用一个 string 类型来模拟一个 Bit 数组，数组的下标就是偏移量，值只有 0 和 1，也支持一些位运算，比如与、或、非和异或等等。他们的运用非常广泛，比如用来记录用户的签到情况，在线状态，点赞状态。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># bitmap 操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>setbit key offset value				<span class="token comment"># 设置位图 key 偏移量为 offset 的位置为 value (0/1)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>getbit key offset				    <span class="token comment"># 获取位图 key 偏移量为 offset 的位置的值</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">set</span> key value					   <span class="token comment"># 位图本质是 string，可以通过设置 string 的方法来设置位图，value 转化为二进制即为对应位图的值</span></pre></td></tr><tr><td data-num="5"></td><td><pre>bitcount key 					   <span class="token comment"># 获取位图 key 内 1 的个数</span></pre></td></tr><tr><td data-num="6"></td><td><pre>bitpos key bit					   <span class="token comment"># 获取位图 key 内第一次出现 bit 的下标 (0 开始)</span></pre></td></tr></table></figure><p>位域能够将很多小的整数存储到一个较大的位图中，这样就可以更加高效的使用内存</p><p>redis 支持事务，也就是可以在一次请求中执行多个命令；redis 中的事务主要通过 <code>multi</code> 和 <code>exec</code> 这两个命令来实现的； <code>multi</code> 命令用来开启一个事务，事务开启之后所以的命令都会被放进一个队列中，最后通过一个 <code>exec</code> 命令来执行所以的命令。redis 中是事务和 mysql 或者 oracle 中的数据库的事务不太一样，在关系型数据库中，事务一般是一个原子操作，要么全部执行成功，要么全部执行失败；而在 redis 中，事务并不能保证所以命令都会执行成功，它的执行结果取决于事务中的命令，但是 redis 可以保证如下三点：</p><ul><li>在发送 <code>exec</code> 命令之前，所以的命令都会被放入到一个队列中缓存起来，不会立即执行</li><li>在收到 <code>exec</code> 命令之后事务开始执行，事务中的任何一个命令执行失败其他命令依然会被执行（不会以为其中的命令执行失败而影响后续的命令的执行）</li><li>在事务的执行过程中，其他客户端提交的命令请求并不会被插入到执行命令序列中</li></ul><p>持久化的 redis 一个非常重要的功能，因为 redis 是一个基于内存的数据库，如果没有持久化的话，那么一旦服务器重启或者断点，那么之前的所以数据都会丢失，这对于一个数据库来说是非常致命的。redis 中的持久化主要由两种方式：</p><ul><li>RDB 方式（redis databse），在指定的时间间隔内，将内存中的数据快照写入磁盘，他是某一时间点上数据的完整副本</li><li>AOF 方式（Append-Only File），追加文件，每次在执行写命令的时候，不仅将命令写入到内存中，还会将命令写入到一个追加的文件中，这个文件就是 AOF 文件，它会以日志的形式来记录每一个写操作，当 redis 重启的时候，就会通过重新执行 AOF 文件中的命令来在内存中重建整个数据库的内容</li></ul><p>主从复制是指将一台服务器（主节点）的数据复制到其他 redis 服务器中（从节点）。一个主节点可以有多个从节点，而每个从节点只可以有一个主节点，数据的复制是单向的，只能由主节点到从节点；一般来说主节点负责写操作，从节点负责读操作，主节点会将自己的数据变化通过异步的方式发送给从节点，从节点接收到主节点的数据之后，更新自己的数据，这样就达到的了数据一致性的目的。</p><p>面试问题：</p><ol><li><code>redis</code> 是多线程还是单线程？<ul><li>在早期的 <code>redis</code> 版本中， <code>redis</code> 的网络 <code>I/O</code> 和键值对的读写操作是由单线程来处理的；在回来的版本，在网络 <code>I/O</code> 模块使用了多线程，但是对于键值对的操作仍然使用的是单线程（故无论是早期版本的 <code>redis</code> 还是当前版本的 <code>redis</code> 均是并发安全的）；当然对于一个 <code>redis</code> 的数据持久化，集群同步等问题都是使用多线程来完成，需要额外的开销</li></ul></li><li><code>redis</code> 为什么速度快？<ul><li><code>redis</code> 的一种基于内存的数据存储系统，相比于涉及到磁盘操作的 <code>mysql</code> 等其他数据库而言，对于内存的操作会更快。</li><li><code>redis</code> 对于键值对的读写操作是单线程的，不需要额外线程切换的开销</li><li><code>redis</code> 底层通过哈希对数据进行映射，可以实现线性的存储与访问；同时在访问冲突大时，使用渐进式的 <code>rehash</code> 机制来进行重新映射</li><li><code>redis</code> 内部维护了一个缓存时间戳，避免的频繁的系统调用而导致的额外开销。（ <code>redis</code> 获取系统的毫秒时间戳并不会频繁的调用 <code>time()</code> 这样的系统调用， <code>redis</code> 会对时间戳进行缓存，同时通过额外的线程来对时间戳进行更新）</li></ul></li></ol><div class="tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="ic i-tag"></i> 数据库</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2023-12-19 16:19:58" itemprop="dateModified" datetime="2023-12-19T16:19:58+08:00">2023-12-19</time> </span><span id="value/redis.html" class="item leancloud_visitors" data-flag-title="redis" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="Value WeChat Pay"><p>WeChat Pay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Value <i class="ic i-at"><em>@</em></i>繁華落盡 似水流年</li><li class="link"><strong>Post link: </strong><a href="http://example.com/value/redis" title="redis">http://example.com/value/redis</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/value/stl_list" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;dogefs.s3.ladydaily.com&#x2F;~&#x2F;source&#x2F;unsplash&#x2F;photo-1709217745929-2bfa3713a584?q&#x3D;80&amp;w&#x3D;1942&amp;auto&#x3D;format&amp;fit&#x3D;crop&amp;ixlib&#x3D;rb-4.0.3&amp;ixid&#x3D;M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" title="STL List"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> STL</span><h3>STL List</h3></a></div><div class="item right"><a href="/value/%E9%87%91%E5%B1%B1%E4%BC%9A%E8%AE%AE%E5%AE%A4%E9%A2%84%E7%BA%A6%E7%B3%BB%E7%BB%9F" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;dogefs.s3.ladydaily.com&#x2F;~&#x2F;source&#x2F;unsplash&#x2F;photo-1706511092839-a184c0acc499?q&#x3D;80&amp;w&#x3D;1998&amp;auto&#x3D;format&amp;fit&#x3D;crop&amp;ixlib&#x3D;rb-4.0.3&amp;ixid&#x3D;M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" title="金山会议室预约系统"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> C++</span><h3>金山会议室预约系统</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#redis"><span class="toc-number">1.</span> <span class="toc-text">Redis</span></a></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li class="active"><a href="/value/redis" rel="bookmark" title="redis">redis</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Value" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Value</p><div class="description" itemprop="description">编程日记 & 随笔</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">11</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">11</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">10</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NwZWNpYWwtSmlhSGFv" title="https:&#x2F;&#x2F;github.com&#x2F;Special-JiaHao"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTIwNDE4OTkzODk=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;2041899389"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNDMzNDE3NDUwP3NwbV9pZF9mcm9tPTMzMy4zMzcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;433417450?spm_id_from&#x3D;333.337.0.0"><i class="ic i-bilibili"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmpoMTU3NzA5QDE2My5jb20=" title="mailto:jh157709@163.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/value/stl_list" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/value/%E9%87%91%E5%B1%B1%E4%BC%9A%E8%AE%AE%E5%AE%A4%E9%A2%84%E7%BA%A6%E7%B3%BB%E7%BB%9F" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/C/" title="In C++">C++</a> <i class="ic i-angle-right"></i> <a href="/categories/C/STL/" title="In STL">STL</a></div><span><a href="/value/stl_list" title="STL List">STL List</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Tools/" title="In Tools">Tools</a></div><span><a href="/value/cmake" title="cmake">cmake</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Mearning-Learning/" title="In Mearning Learning">Mearning Learning</a></div><span><a href="/value/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C" title="Convolutional Neural Network">Convolutional Neural Network</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Markdown/" title="In Markdown">Markdown</a></div><span><a href="/value/Markdown%20grammar" title="Markdown语法">Markdown语法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Machine-Learning/" title="In Machine Learning">Machine Learning</a> <i class="ic i-angle-right"></i> <a href="/categories/Machine-Learning/Mathematical-methods/" title="In Mathematical methods">Mathematical methods</a></div><span><a href="/value/least%20squares%20method" title="最小二乘法">最小二乘法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="In 数据库">数据库</a></div><span><a href="/value/redis" title="redis">redis</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/C/" title="In C++">C++</a></div><span><a href="/value/%E9%87%91%E5%B1%B1%E4%BC%9A%E8%AE%AE%E5%AE%A4%E9%A2%84%E7%BA%A6%E7%B3%BB%E7%BB%9F" title="金山会议室预约系统">金山会议室预约系统</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Machine-Learning/" title="In Machine Learning">Machine Learning</a> <i class="ic i-angle-right"></i> <a href="/categories/Machine-Learning/Mathematical-methods/" title="In Mathematical methods">Mathematical methods</a></div><span><a href="/value/Graident%20descent" title="梯度下降">梯度下降</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Unix/" title="In Unix">Unix</a></div><span><a href="/value/Unix%20programing" title="UNIX网络编程">UNIX网络编程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ns3/" title="In ns3">ns3</a></div><span><a href="/value/ns3%20install" title="ns3 install">ns3 install</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Value @ Value's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">44k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">40 mins.</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"value/redis.html",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->