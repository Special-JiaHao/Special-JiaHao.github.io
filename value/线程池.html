<!-- build time:Fri Mar 22 2024 23:03:56 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="繁華落盡 似水流年" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="繁華落盡 似水流年" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="繁華落盡 似水流年" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="面试题"><link rel="canonical" href="http://example.com/value/%E7%BA%BF%E7%A8%8B%E6%B1%A0.html"><title>多线程与线程池 - C++ | Value's Blog = 繁華落盡 似水流年 = 寄予厚望 还请善待</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">多线程与线程池</h1><div class="meta"><span class="item" title="Created: 2024-03-17 19:27:36"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-03-17T19:27:36+08:00">2024-03-17</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>6.8k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>6 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Value's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://raw.githubusercontent.com/Special-JiaHao/images/main/多线程与线程池.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CPP/" itemprop="item" rel="index" title="In C++"><span itemprop="name">C++</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://example.com/value/%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Value"><meta itemprop="description" content="寄予厚望 还请善待, 编程日记 & 随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="繁華落盡 似水流年"></span><div class="body md" itemprop="articleBody"><h2 id="创建线程"><a class="anchor" href="#创建线程">#</a> 创建线程</h2><pre><code class="language-c++">/* 查看当前线程ID */
typedef unsigned long int pthread_t;
pthread_t pthread_self(void);
/* 创建进程 */
union pthread_attr_t
&#123;
  char __size[__SIZEOF_PTHREAD_ATTR_T];
  long int __align;
&#125;;
typedef union pthread_attr_t pthread_attr_t;
int pthread_create(pthread_t *newthread, const pthread_attr_t *attr, void *(*start_routine)(void *), void *arg);
/*
Description:
	newthread：传出参数，创建的新线程ID
	addr：线程的属性，一般情况使用默认值即可，NULL
	start_routine:函数指针，创建出的子进程的处理函数，也就是在子线程中需要执行的函数
	arg:作为实参传递到start_routine指针指向的函数内部
Return Value:
	线程创建成功返回0，否则返回对于的错误码
*/
</code></pre><h2 id="线程退出"><a class="anchor" href="#线程退出">#</a> 线程退出</h2><pre><code class="language-c++">void pthread_exit(void *retval);
/*
Description:
	只要调用该函数，当前线程立马退出，并且不影响其他线程的运行，不管是在子进程还是主进程中都可以使用
	retval:线程退出时携带的数据，当前子线程的主进程会得到该数据。如果不需要，指定为NULL。
*/
</code></pre><h2 id="线程回收"><a class="anchor" href="#线程回收">#</a> 线程回收</h2><pre><code class="language-c++">int pthread_join(pthread_t thread, void **retval);
/*
Description:
	用于在子进程退出后，主进程回收子进程的内核资源。该函数为一个堵塞函数，如果子进程还在运行，调用该函数就会堵塞，子线程退出函数解除堵塞，并将线程占用的内核资源回收。
	thread：子进程的进程ID
	retval：二级指针，指向一级指针的地址，是一个传出参数，这个地址中存储了pthread_exit()传递出的数据，如果不需要这个参数，可以指定为NULL。
Return Value:
	线程回收成功返回0，回收失败返回错误码。
*/
</code></pre><h2 id="线程分离"><a class="anchor" href="#线程分离">#</a> 线程分离</h2><p>在某些情况下，程序中的主线程有属于自己的业务处理流程，如果让主线程负责子线程的资源回收，调用 <code>pthread_join()</code> ，只要子线程不退出，主线程就会被一直堵塞，主线程的任务也就不能被执行。</p><pre><code class="language-c++">int pthread_detach(pthread_t thread);
/*
Description:
	调用线程分离函数之后，指定的子线程就可以和主线程分离，当子进程退出的时候，其占用的内核资源就会被系统的其他线程接管并回收。线程分离之后，主线程中使用的pthread_join()就回收不到子线程的资源了。
	thread：子线程ID
*/
</code></pre><h2 id="线程取消"><a class="anchor" href="#线程取消">#</a> 线程取消</h2><pre><code class="language-c++">int pthread_cancel(pthread_t thread);
/*
Description:
	在一个线程中杀死另外一个线程。使用这个函数杀死一个线程需要分两步：
	1. 在线程A中调用线程取消函数pthread_cancel(),指定杀死线程B。
	2. 线程B中执行一次系统调用时才会被杀死，否则仍然存活。
*/
</code></pre><h2 id="线程id比较"><a class="anchor" href="#线程id比较">#</a> 线程 ID 比较</h2><pre><code class="language-c++">int pthread_equal(pthread_t t1, pthread_t t2);
/*
Description:
	t1,t2为需要比较的两个线程ID。
Return Value:
	如果两个线程ID相等返回一个非0值，如果不等则返回0
*/
</code></pre><h2 id="线程同步"><a class="anchor" href="#线程同步">#</a> 线程同步</h2><h3 id="互斥锁"><a class="anchor" href="#互斥锁">#</a> 互斥锁</h3><p>互斥锁是线程同步最常用的一种方式，通过互斥锁可以锁定一个代码块。被锁定的代码块，所以线程只能顺序执行。</p><pre><code class="language-c++">pthread_mutex_t mutex;
/* 初始化互斥锁 */
int pthread_mutex_init(pthread_mutex_t *restrict mutex, const pthread_mutexattr_t *attr);
/*
	mutex: 互斥锁变量地址
	attr: 互斥锁的属性，一般使用默认属性即可，这个参数指定为NULL
	返回0，则初始化成功，否则返回错误码
*/
/* 释放互斥锁 */
int pthread_mutex_destroy(pthread_mutex_t *mutex);
/* 上锁 */
int pthread_mutex_lock(pthread_mutex_t *mutex);
/*
Description:
	这个函数被调用，实现会判断参数mutex互斥锁中的状态是不是锁定状态：
		- 没有锁定，则这个线程可以加锁成功，这个锁会记录是哪一个线程加锁成功了
		- 如果被锁定，其他线程加锁就失败了，这些线程都会被堵塞在这把锁上
		- 当这把锁被解开之后，这些堵塞在锁上的线程就会解除堵塞，并且这些线程通过竞争的方式对这把锁加锁，没抢到锁的进程继续堵塞
*/
/* 尝试加锁 */
int pthread_mutex_trylock(pthread_mutex_t *mutex);
/*
Description:
	尝试对mutex互斥锁进行加锁：
		- 若互斥锁没有被锁定，线程加锁成功
		- 若互斥锁被锁定，调用这个函数加锁的线程，不会被堵塞，加锁失败直接返回错误码
*/

/* 解锁 */
int pthread_mutex_unlock(pthread_mutex_t *mutex);
/*
Description:
	并不是所以的线程都可以对互斥锁解锁，那个线程加的锁，那个线程才可以解锁。
*/
</code></pre><h3 id="死锁"><a class="anchor" href="#死锁">#</a> 死锁</h3><p>当多个线程访问共享资源，需要加锁，如果锁使用不当，就会造成死锁这种现象。</p><h3 id="读写锁"><a class="anchor" href="#读写锁">#</a> 读写锁</h3><p>读锁是共享的，写锁是独占的；写锁比读锁优先级高；如果临界区涉及大量的读操作，使用读写锁比使用互斥锁效率高，而只有少量的读操作，则互斥锁和读写锁效率差异不大</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>pthread_rwlock_t rwlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/* 初始化读写锁 */</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_rwlock_init</span><span class="token punctuation">(</span>pthread_rwlock_t <span class="token operator">*</span>restrict rwlock<span class="token punctuation">,</span> <span class="token keyword">const</span> pthread_rwlockattr_t <span class="token operator">*</span>restrict attr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/* 销毁读写锁 */</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_rwlock_destroy</span><span class="token punctuation">(</span>pthread_rwlock_t <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">/* 加读锁 */</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_rwlock_rdlock</span><span class="token punctuation">(</span>pthread_rwlock_t <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">/* 尝试加读锁，加锁失败不堵塞 */</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_rwlock_tryrdlock</span><span class="token punctuation">(</span>pthread_rwlock_t <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">/* 加写锁 */</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span>pthread_rwlock_t <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">/* 尝试加写锁，加锁失败不堵塞 */</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_rwlock_trywrlock</span><span class="token punctuation">(</span>pthread_rwlock_t <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">/* 解锁（读锁 / 写锁） */</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span>pthread_rwlock_t <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="条件变量"><a class="anchor" href="#条件变量">#</a> 条件变量</h3><p>一般情况下条件变量用于处理生产者和消费者模型，并且和互斥锁配合使用。条件变量类型为 <code>pthread_cond_t</code> ，被条件变量堵塞的线程以及线程信息会被记录到这个变量中，以便在解除堵塞时使用。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>pthread_cond_t cond<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/* 初始化 */</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_cond_init</span><span class="token punctuation">(</span>pthread_cond_t <span class="token operator">*</span>restrict cond<span class="token punctuation">,</span> <span class="token keyword">const</span> pthread_condaddr_t <span class="token operator">*</span>restrict attr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/* 销毁释放资源 */</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_cond_destroy</span><span class="token punctuation">(</span>pthread_cond_t <span class="token operator">*</span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">/* 堵塞当前线程 / 进程 */</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span>pthread_cond_t <span class="token operator">*</span>restrict cond<span class="token punctuation">,</span> pthread_mutex_t <span class="token operator">*</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">timespec</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    time_t tv_sec<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">long</span> tv_nsec<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_cond_timedwait</span><span class="token punctuation">(</span>pthread_cond_t <span class="token operator">*</span>restrict cond<span class="token punctuation">,</span> pthread_mutex_t <span class="token operator">*</span>mutex<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">timespec</span> <span class="token operator">*</span>restrict abstime<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">/* 唤醒堵塞在条件变量上的一个线程 */</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_cond_signal</span><span class="token punctuation">(</span>pthread_cond_t <span class="token operator">*</span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">/* 唤醒所以堵塞在条件变量上的线程 */</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">int</span> <span class="token function">pthread_cond_broadcast</span><span class="token punctuation">(</span>pthread_cond_t <span class="token operator">*</span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="信号量"><a class="anchor" href="#信号量">#</a> 信号量</h3><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;semaphore.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>sem_t sem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">sem_init</span><span class="token punctuation">(</span>sem_t <span class="token operator">*</span>sem<span class="token punctuation">,</span> <span class="token keyword">int</span> pshared<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	sem: 信号量变量地址</pre></td></tr><tr><td data-num="6"></td><td><pre>	pshared: 0 表示线程同步；非 0 表示进程同步</pre></td></tr><tr><td data-num="7"></td><td><pre>	value: 初始化当前信号量拥有的资源数</pre></td></tr><tr><td data-num="8"></td><td><pre>*/</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> <span class="token function">sem_destroy</span><span class="token punctuation">(</span>sem_t <span class="token operator">&amp;</span>sem<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> <span class="token function">sem_wait</span><span class="token punctuation">(</span>sem_t <span class="token operator">*</span>sem<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">int</span> <span class="token function">sem_try_wait</span><span class="token punctuation">(</span>sem_t <span class="token operator">*</span>sem<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">/* 产看信号量 sem 当前拥有的资源个数，通过第二个参数传出（返回值也可以） */</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">int</span> <span class="token function">sem_getvalue</span><span class="token punctuation">(</span>sem_t <span class="token operator">*</span>sem<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>sval<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">int</span> <span class="token function">sem_post</span><span class="token punctuation">(</span>sem_t <span class="token operator">*</span>sem<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="什么是线程池线程池的好处"><a class="anchor" href="#什么是线程池线程池的好处">#</a> 什么是线程池？线程池的好处</h2><blockquote><p>通俗上来说线程池是一个管理线程的池子，它可以容纳多个线程，并对线程可以进行反复的利用，省去了频繁的线程的创建和销毁开销.</p></blockquote><h2 id="线程池的核心参数"><a class="anchor" href="#线程池的核心参数">#</a> 线程池的核心参数</h2><ul><li><p>任务队列：存储需要处理的任务（函数地址）</p><blockquote><ol><li><p>为了管理任务队列，需要线程池提供 API 接口，用于往任务队列中添加任务和删除任务</p></li><li><p>生产者 - 消费者模型</p></li></ol></blockquote></li><li><p>工作的线程（消费者线程）：负责去任务队列中取任务</p><blockquote><ol><li>线程池中维护一定数量的工作线程，不停的读取任务队列并且处理任务函数</li><li>如果任务队列为空，工作的线程会堵塞（使用条件变量 / 信号量）</li><li>工作线程堵塞后有新任务产生，生产者线程会唤醒工作的线程</li></ol></blockquote></li><li><p>管理者线程：主线程</p><blockquote><p>周期性的对任务队列中的任务数量以及工作线程数进行检测，当任务过多时，可以适当的创建一些新的工作线程；当任务过少时，可以适当</p></blockquote></li></ul><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 任务结构体</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> callback <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Task</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  	<span class="token comment">//  void (*function)(void *arg);	/* 任务函数 */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    callback function<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">;</span>	<span class="token comment">/* 任务参数 */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        function <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        arg <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">Task</span><span class="token punctuation">(</span>callback f<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">this</span><span class="token operator">-></span>arg <span class="token operator">=</span> arg<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">this</span><span class="token operator">-></span>function <span class="token operator">=</span> f<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// 任务队列</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">TaskQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token operator">~</span><span class="token function">TaskQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span>$mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">/* 添加任务 */</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">addTask</span><span class="token punctuation">(</span>Task task<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        taskQu<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Task<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">/* 取任务 */</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    Task <span class="token function">takeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        Task t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>taskQu<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            t <span class="token operator">=</span> taskQu<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            taskQu<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">return</span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token comment">/* 获取当前任务数目 */</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">int</span> <span class="token function">getQueueSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> taskQu<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    queue<span class="token operator">&lt;</span>Task<span class="token operator">></span> taskQu<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num="48"></td><td><pre>    pthread_mutex_t mutex<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token comment">// 线程池结构体</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ThreadPool</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> min<span class="token punctuation">,</span> <span class="token keyword">int</span> max<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token keyword">do</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            taskQu <span class="token operator">=</span> <span class="token keyword">new</span> taskQu<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>taskQu <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"new taskQu fail..."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            threadIDs <span class="token operator">=</span> <span class="token keyword">new</span> pthread_t<span class="token punctuation">[</span>max<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>threadIDs <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"new threadIDs fail..."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token function">memset</span><span class="token punctuation">(</span>threadIDs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>pthread_t<span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token keyword">this</span><span class="token operator">-></span>minThreadCount <span class="token operator">=</span> min<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token keyword">this</span><span class="token operator">-></span>maxThreadCount <span class="token operator">=</span> max<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token keyword">this</span><span class="token operator">-></span>busyThreadCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            <span class="token keyword">this</span><span class="token operator">-></span>liveThreadCount <span class="token operator">=</span> min<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token keyword">this</span><span class="token operator">-></span>shutdown <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutexPool<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token function">pthread_cond_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>notEmpty<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"mutex or condition init fail..."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token comment">/* 创建管理者线程 */</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>managerID<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> manager<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            <span class="token comment">/* 创建工作的线程 */</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> min<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span>	<span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threadIDs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> worker<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token comment">/* 初始化失败，释放资源 */</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>threadIDs<span class="token punctuation">)</span>	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> threadIDs<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>taskQu<span class="token punctuation">)</span>	<span class="token keyword">delete</span> taskQu<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    TaskQueue<span class="token operator">*</span> taskQu<span class="token punctuation">;</span>		<span class="token comment">/* 任务队列 */</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    pthread_t managerID		<span class="token comment">/* 管理者线程 ID */</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    pthread_t <span class="token operator">*</span>threadIDs	<span class="token comment">/* 工作的线程 ID */</span></pre></td></tr><tr><td data-num="89"></td><td><pre>    <span class="token keyword">int</span> minThreadCount<span class="token punctuation">;</span>		<span class="token comment">/* 初始 / 最少线程数 */</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token keyword">int</span> maxThreadCount<span class="token punctuation">;</span>		<span class="token comment">/* 最大线程数 */</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    <span class="token keyword">int</span> busyThreadCount<span class="token punctuation">;</span>	<span class="token comment">/* 忙线程数目 */</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    <span class="token keyword">int</span> liveThreadCount<span class="token punctuation">;</span>	<span class="token comment">/* 存活线程数目 */</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    pthread_mutex_t	mutexPool<span class="token punctuation">;</span>	<span class="token comment">/* 线程池锁 (互斥锁) */</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    pthread_mutex_t mutexBusy<span class="token punctuation">;</span>	<span class="token comment">/* 忙线程数锁 */</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token keyword">bool</span> shutdown<span class="token punctuation">;</span>			<span class="token comment">/* 线程池销毁标志 */</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    pthread_cond_t notEmpty<span class="token punctuation">;</span> <span class="token comment">/* 任务队列是否空 (生产者唤醒消费者) */</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        ThreadPool<span class="token operator">*</span> pool <span class="token operator">=</span> <span class="token punctuation">(</span>ThreadPool<span class="token operator">*</span><span class="token punctuation">)</span>arg<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pool<span class="token operator">-></span>mutexPool<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token keyword">while</span><span class="token punctuation">(</span>pool<span class="token operator">-></span>taskQu<span class="token operator">-></span><span class="token function">getQueueSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pool<span class="token operator">-></span>shutdown<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pool<span class="token operator">-></span>notEmpty<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pool<span class="token operator">-></span>mutexPool<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>pool<span class="token operator">-></span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>                </pre></td></tr><tr><td data-num="104"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>pool<span class="token operator">-></span>shutdown<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>            <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pool<span class="token operator">-></span>mutexPool<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>            </pre></td></tr><tr><td data-num="109"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>        pool<span class="token operator">-></span>busyThreadCount <span class="token operator">++</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>        Task task <span class="token operator">=</span> pool<span class="token operator">-></span>taskQu<span class="token operator">-></span><span class="token function">takeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pool<span class="token operator">-></span>mutexPool<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>        task<span class="token punctuation">.</span><span class="token function">function</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token keyword">delete</span> task<span class="token punctuation">.</span>arg<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>        task<span class="token punctuation">.</span>arg <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutexBusy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>        pool<span class="token operator">-></span>busyThreadCount <span class="token operator">--</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutexBusy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>        </pre></td></tr><tr><td data-num="120"></td><td><pre>    	</pre></td></tr><tr><td data-num="121"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>        </pre></td></tr><tr><td data-num="124"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag"><i class="ic i-tag"></i> 面试题</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2024-03-18 10:28:22" itemprop="dateModified" datetime="2024-03-18T10:28:22+08:00">2024-03-18</time> </span><span id="value/线程池.html" class="item leancloud_visitors" data-flag-title="多线程与线程池" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="Value WeChat Pay"><p>WeChat Pay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Value <i class="ic i-at"><em>@</em></i>繁華落盡 似水流年</li><li class="link"><strong>Post link: </strong><a href="http://example.com/value/%E7%BA%BF%E7%A8%8B%E6%B1%A0" title="多线程与线程池">http://example.com/value/线程池</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/value/Leetcode/%E7%AC%AC%20126%20%E5%9C%BA%E5%8F%8C%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;images.pexels.com&#x2F;photos&#x2F;5641973&#x2F;pexels-photo-5641973.jpeg" title="第 126 场双周赛"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> Leetcode</span><h3>第 126 场双周赛</h3></a></div><div class="item right"><a href="/value/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Special-JiaHao&#x2F;images&#x2F;main&#x2F;数据库连接池.png" title="数据库连接池"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> C++</span><h3>数据库连接池</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">创建线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E9%80%80%E5%87%BA"><span class="toc-number">2.</span> <span class="toc-text">线程退出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%9B%9E%E6%94%B6"><span class="toc-number">3.</span> <span class="toc-text">线程回收</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%88%86%E7%A6%BB"><span class="toc-number">4.</span> <span class="toc-text">线程分离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%8F%96%E6%B6%88"><span class="toc-number">5.</span> <span class="toc-text">线程取消</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8Bid%E6%AF%94%E8%BE%83"><span class="toc-number">6.</span> <span class="toc-text">线程 ID 比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-number">7.</span> <span class="toc-text">线程同步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%92%E6%96%A5%E9%94%81"><span class="toc-number">7.1.</span> <span class="toc-text">互斥锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-number">7.2.</span> <span class="toc-text">死锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E9%94%81"><span class="toc-number">7.3.</span> <span class="toc-text">读写锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F"><span class="toc-number">7.4.</span> <span class="toc-text">条件变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E9%87%8F"><span class="toc-number">7.5.</span> <span class="toc-text">信号量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">8.</span> <span class="toc-text">什么是线程池？线程池的好处</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text">线程池的核心参数</span></a></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/value/stl_list" rel="bookmark" title="STL List">STL List</a></li><li><a href="/value/%E9%87%91%E5%B1%B1%E4%BC%9A%E8%AE%AE%E5%AE%A4%E9%A2%84%E7%BA%A6%E7%B3%BB%E7%BB%9F" rel="bookmark" title="金山会议室预约系统">金山会议室预约系统</a></li><li><a href="/value/C++%E9%9D%A2%E8%AF%95%E9%A2%98" rel="bookmark" title="C++面试题">C++面试题</a></li><li><a href="/value/%E7%BE%8E%E5%9B%A2%E6%A0%A1%E6%8B%9B" rel="bookmark" title="美团校招">美团校招</a></li><li class="active"><a href="/value/%E7%BA%BF%E7%A8%8B%E6%B1%A0" rel="bookmark" title="多线程与线程池">多线程与线程池</a></li><li><a href="/value/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0" rel="bookmark" title="数据库连接池">数据库连接池</a></li><li><a href="/value/%E8%85%BE%E8%AE%AF%E6%A0%A1%E6%8B%9B" rel="bookmark" title="腾讯校招">腾讯校招</a></li><li><a href="/value/%E8%9A%82%E8%9A%81%E9%9B%86%E5%9B%A2%E6%A0%A1%E6%8B%9B" rel="bookmark" title="蚂蚁集团校招">蚂蚁集团校招</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Value" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Value</p><div class="description" itemprop="description">编程日记 & 随笔</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">18</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">16</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NwZWNpYWwtSmlhSGFv" title="https:&#x2F;&#x2F;github.com&#x2F;Special-JiaHao"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTIwNDE4OTkzODk=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;2041899389"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNDMzNDE3NDUwP3NwbV9pZF9mcm9tPTMzMy4zMzcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;433417450?spm_id_from&#x3D;333.337.0.0"><i class="ic i-bilibili"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmpoMTU3NzA5QDE2My5jb20=" title="mailto:jh157709@163.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/value/Leetcode/%E7%AC%AC%20126%20%E5%9C%BA%E5%8F%8C%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/value/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Mearning-Learning/" title="In Mearning Learning">Mearning Learning</a></div><span><a href="/value/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C" title="Convolutional Neural Network">Convolutional Neural Network</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CPP/" title="In C++">C++</a></div><span><a href="/value/%E7%BE%8E%E5%9B%A2%E6%A0%A1%E6%8B%9B" title="美团校招">美团校招</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/daily/" title="In daily">daily</a></div><span><a href="/value/daily/Feelings" title="Feelings">Feelings</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/VMware/" title="In VMware">VMware</a></div><span><a href="/value/VMware%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98" title="VMware Workstation遇到的一些问题">VMware Workstation遇到的一些问题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="In 计算机网络">计算机网络</a></div><span><a href="/value/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95%E9%A2%98" title="计算机网络面试题">计算机网络面试题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Machine-Learning/" title="In Machine Learning">Machine Learning</a> <i class="ic i-angle-right"></i> <a href="/categories/Machine-Learning/Mathematical-methods/" title="In Mathematical methods">Mathematical methods</a></div><span><a href="/value/least%20squares%20method" title="最小二乘法">最小二乘法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Tools/" title="In Tools">Tools</a></div><span><a href="/value/cmake" title="cmake">cmake</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="In Algorithm">Algorithm</a></div><span><a href="/value/Algorithm/%E4%BA%8C%E5%88%86" title="二分">二分</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Markdown/" title="In Markdown">Markdown</a></div><span><a href="/value/Markdown%20grammar" title="Markdown语法">Markdown语法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="In 数据库">数据库</a></div><span><a href="/value/MySQL%E9%9D%A2%E8%AF%95%E9%A2%98" title="MySQL面试题">MySQL面试题</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Value @ Value's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">113k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">1:43</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"value/线程池.html",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->